<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta name="baidu-site-verification" content="L6Lm9d5Crl">
  
  
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternative" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.png">
  
  
  <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
    
    
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <!-- 加载特效 -->
    <script src="/js/pace.js"></script>
    <link href="/css/pace/pace-theme-flash.css" rel="stylesheet">
  <script>
      var yiliaConfig = {
          fancybox: true,
          animate: true,
          isHome: true,
          isPost: false,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
</head></html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        
<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>

        <a href="/" class="profilepic">
            
            <img lazy-src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1565358714416&amp;di=db969344db196a4bd9c41365b8e45c8a&amp;imgtype=0&amp;src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2F3082ac27c9139ea7b80b1c88f31ea86f8531f25611dcf-Owa1Zu_fw658" class="js-avatar">
            
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">John Doe</a></h1>
        </hgroup>
        
        
            <form>
                <input type="text" class="st-default-search-input search" id="local-search-input" placeholder="搜索一下" autocomplete="off">
            </form>
            <div id="local-search-result"></div>
        
        
            <script type="text/javascript">
                (function() {
                    'use strict';
                    function getMatchData(keyword, data) {
                        var matchData = [];
                        for(var i =0;i<data.length;i++){
                            if(data[i].title.toLowerCase().indexOf(keyword)>=0) 
                                matchData.push(data[i])
                        }
                        return matchData;
                    }
                    var $input = $('#local-search-input');
                    var $resultContent = $('#local-search-result');
                    $input.keyup(function(){
                        $.ajax({
                            url: '/search.json',
                            dataType: "json",
                            success: function( json ) {
                                var str='<ul class=\"search-result-list\">';                
                                var keyword = $input.val().trim().toLowerCase();
                                $resultContent.innerHTML = "";
                                if ($input.val().trim().length <= 0) {
                                    $resultContent.empty();
                                    $('#switch-area').show();
                                    return;
                                }
                                var results = getMatchData(keyword, json);
                                if(results.length === 0){
                                    $resultContent.empty();
                                    $('#switch-area').show();
                                    return;
                                } 
                                for(var i =0; i<results.length; i++){
                                    str += "<li><a href='"+ results[i].url +"' class='search-result-title'>"+ results[i].title +"</a></li>";
                                }
                                str += "</ul>";
                                $resultContent.empty();
                                $resultContent.append(str);
                                $('#switch-area').hide();
                            }
                        });
                    });
                })();
            </script>
        
        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        
        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a  href="/archives/">所有文章</a></li>
                        
                            <li><a  href="/categories/开发工具/">玩转开发工具</a></li>
                        
                            <li><a  href="/categories/digital">玩转数码</a></li>
                        
                            <li><a  href="/categories/algorithm">算法学习</a></li>
                        
                            <li><a  href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fl github"  target="_blank" href="/xxxxx" title="github">github</a>
                            
                                <a class="fl weibo"  target="_blank" href="/xxxxxxxx" title="weibo">weibo</a>
                            
                                <a class="fl rss"  target="_blank" href="/atom.xml" title="rss">rss</a>
                            
                        </ul>
                    </nav>
                </section>
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <a href="/tags/web安全/" style="font-size: 12.5px;">web安全</a> <a href="/tags/渗透/" style="font-size: 10px;">渗透</a> <a href="/tags/系统安全/" style="font-size: 20px;">系统安全</a> <a href="/tags/网络/" style="font-size: 17.5px;">网络</a> <a href="/tags/网络安全/" style="font-size: 15px;">网络安全</a>
                    </div>
                </section>
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://blog.csdn.net/baidu_21483933">csdn</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="https://segmentfault.com/blog/maocg_web">segmentfault</a>
                    
                      <a target="_blank"  class="main-nav-link switch-friends-link" href="http://www.jianshu.com/users/eb37ef89c746/latest_articles">简书</a>
                    
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">爱动漫,爱游戏,爱编程,爱运动,爱的太多了!</div>
                </section>
                
            </div>
        </div>
    </header>
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">John Doe</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1565358714416&amp;di=db969344db196a4bd9c41365b8e45c8a&amp;imgtype=0&amp;src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2F3082ac27c9139ea7b80b1c88f31ea86f8531f25611dcf-Owa1Zu_fw658" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">John Doe</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/categories/开发工具/">玩转开发工具</a></li>
                
                    <li><a href="/categories/digital">玩转数码</a></li>
                
                    <li><a href="/categories/algorithm">算法学习</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <div class="social">
                    
                        <a class="github" target="_blank" href="/xxxxx" title="github">github</a>
                    
                        <a class="weibo" target="_blank" href="/xxxxxxxx" title="weibo">weibo</a>
                    
                        <a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
                    
                </div>
            </nav>
        </header>
    </div>
</nav>
      <div class="body-wrap">
  
    <article id="post-08-24第1篇：Window入侵排查" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2019/09/04/08-24第1篇：Window入侵排查/" class="article-date">
      <time datetime="2019-09-04T01:09:51.645Z" itemprop="datePublished">2019-09-04</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2019/09/04/08-24第1篇：Window入侵排查/">window入侵排查</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <a id="more"></a>

<h2 id="第1篇：window入侵排查"><a href="#第1篇：window入侵排查" class="headerlink" title="第1篇：window入侵排查"></a>第1篇：window入侵排查</h2><h3 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h3><p>当企业发生黑客入侵、系统崩溃或其它影响业务正常运行的安全事件时，急需第一时间进行处理，使企业的网络信息系统在最短时间内恢复正常工作，进一步查找入侵来源，还原入侵事故过程，同时给出解决方案与防范措施，为企业挽回或减少经济损失。  </p>
<p>常见的应急响应事件分类：</p>
<p>web入侵：网页挂马、主页篡改、Webshell</p>
<p>系统入侵：病毒木马、勒索软件、远控后门</p>
<p>网络攻击：DDOS攻击、DNS劫持、ARP欺骗</p>
<p>针对常见的攻击事件，结合工作中应急响应事件分析和解决的方法，总结了一些Window服务器入侵排查的思路。</p>
<h3 id="0x01-入侵排查思路"><a href="#0x01-入侵排查思路" class="headerlink" title="0x01 入侵排查思路"></a>0x01 入侵排查思路</h3><h4 id="1-1-检查系统账号安全"><a href="#1-1-检查系统账号安全" class="headerlink" title="1.1 检查系统账号安全"></a>1.1 检查系统账号安全</h4><p>1、查看服务器是否有弱口令，远程管理端口是否对公网开放。</p>
<ul>
<li>检查方法：据实际情况咨询相关服务器管理员。</li>
</ul>
<p>2、查看服务器是否存在可疑账号、新增账号。</p>
<ul>
<li>检查方法：打开 cmd 窗口，输入<code>lusrmgr.msc</code>命令，查看是否有新增/可疑的账号，如有管理员群组的（Administrators）里的新增账户，如有，请立即禁用或删除掉。 </li>
</ul>
<p>3、查看服务器是否存在隐藏账号、克隆账号。</p>
<ul>
<li><p>检查方法：</p>
<p>a、打开注册表 ，查看管理员对应键值。</p>
<p>b、使用D盾_web查杀工具，集成了对克隆账号检测的功能。</p>
</li>
</ul>
<p><img src="./image/sum-1-1.png" alt></p>
<p>4、结合日志，查看管理员登录时间、用户名是否存在异常。</p>
<ul>
<li><p>检查方法：</p>
<p>a、Win+R打开运行，输入“eventvwr.msc”，回车运行，打开“事件查看器”。</p>
<p>b、导出Windows日志–安全，利用Log Parser进行分析。</p>
</li>
</ul>
<p><img src="./image/sum-1-2.png" alt></p>
<h4 id="1-2-检查异常端口、进程"><a href="#1-2-检查异常端口、进程" class="headerlink" title="1.2 检查异常端口、进程"></a>1.2 检查异常端口、进程</h4><p>1、检查端口连接情况，是否有远程连接、可疑连接。</p>
<ul>
<li><p>检查方法：</p>
<p>a、netstat -ano 查看目前的网络连接，定位可疑的ESTABLISHED </p>
<p>b、根据netstat 定位出的pid，再通过tasklist命令进行进程定位 tasklist  | findstr “PID”</p>
</li>
</ul>
<p><img src="./image/sum-1-3.png" alt></p>
<p>2、进程</p>
<ul>
<li><p>检查方法：</p>
<p>a、开始–运行–输入msinfo32，依次点击“软件环境→正在运行任务”就可以查看到进程的详细信息，比如进程路径、进程ID、文件创建日期、启动时间等。</p>
<p>b、打开D盾_web查杀工具，进程查看，关注没有签名信息的进程。</p>
<p>c、通过微软官方提供的 Process Explorer 等工具进行排查 。</p>
<p>d、查看可疑的进程及其子进程。可以通过观察以下内容：</p>
<pre><code>没有签名验证信息的进程
没有描述信息的进程
进程的属主
进程的路径是否合法
CPU或内存资源占用长时间过高的进程</code></pre></li>
</ul>
<p>3、小技巧：</p>
<p>​    a、查看端口对应的PID： netstat -ano | findstr “port”</p>
<p>​    b、查看进程对应的PID：任务管理器–查看–选择列–PID 或者  tasklist  | findstr “PID”</p>
<p>​    c、查看进程对应的程序位置：</p>
<p>​        任务管理器–选择对应进程–右键打开文件位置</p>
<p>​        运行输入 wmic，cmd界面 输入  process</p>
<p>​    d、tasklist /svc   进程–PID–服务</p>
<p>​    e、查看Windows服务所对应的端口：<br>​        %system%/system32/drivers/etc/services（一般%system%就是C:\Windows）</p>
<h4 id="1-3-检查启动项、计划任务、服务"><a href="#1-3-检查启动项、计划任务、服务" class="headerlink" title="1.3 检查启动项、计划任务、服务"></a>1.3 检查启动项、计划任务、服务</h4><p>1、检查服务器是否有异常的启动项。</p>
<ul>
<li><p>检查方法：</p>
<p>a、登录服务器，单击【开始】&gt;【所有程序】&gt;【启动】，默认情况下此目录在是一个空目录，确认是否有非业务程序在该目录下。<br>b、单击开始菜单 &gt;【运行】，输入 msconfig，查看是否存在命名异常的启动项目，是则取消勾选命名异常的启动项目，并到命令中显示的路径删除文件。<br>c、单击【开始】&gt;【运行】，输入 regedit，打开注册表，查看开机启动项是否正常，特别注意如下三个注册表项：<br>HKEY_CURRENT_USER\software\micorsoft\windows\currentversion\run<br>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run<br>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Runonce<br>检查右侧是否有启动异常的项目，如有请删除，并建议安装杀毒软件进行病毒查杀，清除残留病毒或木马。</p>
<p>d、利用安全软件查看启动项、开机时间管理等。</p>
<p>e、组策略，运行gpedit.msc。</p>
</li>
</ul>
<p><img src="./image/sum-1-4.png" alt></p>
<p>2、检查计划任务</p>
<ul>
<li><p>检查方法：</p>
<p>a、单击【开始】&gt;【设置】&gt;【控制面板】&gt;【任务计划】，查看计划任务属性，便可以发现木马文件的路径。</p>
<p>b、单击【开始】&gt;【运行】；输入 cmd，然后输入at，检查计算机与网络上的其它计算机之间的会话或计划任务，如有，则确认是否为正常连接。</p>
</li>
</ul>
<p>3、服务自启动</p>
<ul>
<li>检查方法：单击【开始】&gt;【运行】，输入services.msc，注意服务状态和启动类型，检查是否有异常服务。</li>
</ul>
<h4 id="1-4-检查系统相关信息"><a href="#1-4-检查系统相关信息" class="headerlink" title="1.4 检查系统相关信息"></a>1.4 检查系统相关信息</h4><p>1、查看系统版本以及补丁信息</p>
<ul>
<li>检查方法：单击【开始】&gt;【运行】，输入systeminfo，查看系统信息</li>
</ul>
<p>2、查找可疑目录及文件</p>
<ul>
<li><p>检查方法：</p>
<p>a、 查看用户目录，新建账号会在这个目录生成一个用户目录，查看是否有新建用户目录。</p>
<p>​    Window 2003  C:\Documents and Settings</p>
<p>​    Window 2008R2  C:\Users\</p>
<p>b、单击【开始】&gt;【运行】，输入%UserProfile%\Recent，分析最近打开分析可疑文件。</p>
<p>c、在服务器各个目录，可根据文件夹内文件列表时间进行排序，查找可疑文件。</p>
<p>d、回收站、浏览器下载目录、浏览器历史记录</p>
<p>e、修改时间在创建时间之前的为可疑文件</p>
</li>
</ul>
<p>3、得到发现WEBSHELL、远控木马的创建时间，如何找出同一时间范围内创建的文件？</p>
<p>​    a、利用 Registry Workshop  注册表编辑器的搜索功能，可以找到最后写入时间区间的文件。</p>
<p>​    b、利用计算机自带文件搜索功能，指定修改时间进行搜索。</p>
<h4 id="1-5-自动化查杀"><a href="#1-5-自动化查杀" class="headerlink" title="1.5 自动化查杀"></a>1.5 自动化查杀</h4><ul>
<li><p>病毒查杀</p>
<ul>
<li>检查方法：下载安全软件，更新最新病毒库，进行全盘扫描。</li>
</ul>
</li>
<li><p>webshell查杀</p>
<ul>
<li>检查方法：选择具体站点路径进行webshell查杀，建议使用两款webshell查杀工具同时查杀，可相互补充规则库的不足。</li>
</ul>
</li>
</ul>
<h4 id="1-6-日志分析"><a href="#1-6-日志分析" class="headerlink" title="1.6 日志分析"></a>1.6 日志分析</h4><p>系统日志</p>
<ul>
<li><p>分析方法：</p>
<p>a、前提：开启审核策略，若日后系统出现故障、安全事故则可以查看系统的日志文件，排除故障，追查入侵者的信息等。</p>
<p>b、Win+R打开运行，输入“eventvwr.msc”，回车运行，打开“事件查看器”。</p>
<p>C、导出应用程序日志、安全日志、系统日志，利用Log Parser进行分析。</p>
</li>
</ul>
<p>WEB访问日志</p>
<ul>
<li><p>分析方法：</p>
<p>a、找到中间件的web日志，打包到本地方便进行分析。</p>
<p>b、推荐工具：Window下，推荐用 EmEditor 进行日志分析，支持大文本，搜索效率还不错。</p>
<p>​                 Linux下，使用Shell命令组合查询分析</p>
</li>
</ul>
<h3 id="0x02-工具篇"><a href="#0x02-工具篇" class="headerlink" title="0x02 工具篇"></a>0x02 工具篇</h3><h4 id="2-1-病毒分析"><a href="#2-1-病毒分析" class="headerlink" title="2.1 病毒分析"></a>2.1 病毒分析</h4><p>PCHunter：<a href="http://www.xuetr.com" target="_blank" rel="noopener">http://www.xuetr.com</a></p>
<p>火绒剑：<a href="https://www.huorong.cn" target="_blank" rel="noopener">https://www.huorong.cn</a></p>
<p>Process Explorer：<a href="https://docs.microsoft.com/zh-cn/sysinternals/downloads/process-explorer" target="_blank" rel="noopener">https://docs.microsoft.com/zh-cn/sysinternals/downloads/process-explorer</a></p>
<p>processhacker：<a href="https://processhacker.sourceforge.io/downloads.php" target="_blank" rel="noopener">https://processhacker.sourceforge.io/downloads.php</a></p>
<p>autoruns：<a href="https://docs.microsoft.com/en-us/sysinternals/downloads/autoruns" target="_blank" rel="noopener">https://docs.microsoft.com/en-us/sysinternals/downloads/autoruns</a></p>
<p>OTL：<a href="https://www.bleepingcomputer.com/download/otl/" target="_blank" rel="noopener">https://www.bleepingcomputer.com/download/otl/</a></p>
<p>SysInspector：<a href="http://download.eset.com.cn/download/detail/?product=sysinspector" target="_blank" rel="noopener">http://download.eset.com.cn/download/detail/?product=sysinspector</a></p>
<h4 id="2-2-病毒查杀"><a href="#2-2-病毒查杀" class="headerlink" title="2.2 病毒查杀"></a>2.2 病毒查杀</h4><p>卡巴斯基：<a href="http://devbuilds.kaspersky-labs.com/devbuilds/KVRT/latest/full/KVRT.exe" target="_blank" rel="noopener">http://devbuilds.kaspersky-labs.com/devbuilds/KVRT/latest/full/KVRT.exe</a>   （推荐理由：绿色版、最新病毒库）</p>
<p>大蜘蛛：<a href="http://free.drweb.ru/download+cureit+free（推荐理由：扫描快、一次下载只能用1周，更新病毒库）" target="_blank" rel="noopener">http://free.drweb.ru/download+cureit+free（推荐理由：扫描快、一次下载只能用1周，更新病毒库）</a></p>
<p>火绒安全软件：<a href="https://www.huorong.cn" target="_blank" rel="noopener">https://www.huorong.cn</a></p>
<p>360杀毒：<a href="http://sd.360.cn/download_center.html" target="_blank" rel="noopener">http://sd.360.cn/download_center.html</a></p>
<h4 id="2-3-病毒动态"><a href="#2-3-病毒动态" class="headerlink" title="2.3 病毒动态"></a>2.3 病毒动态</h4><p>CVERC-国家计算机病毒应急处理中心：<a href="http://www.cverc.org.cn" target="_blank" rel="noopener">http://www.cverc.org.cn</a></p>
<p>微步在线威胁情报社区：<a href="https://x.threatbook.cn" target="_blank" rel="noopener">https://x.threatbook.cn</a></p>
<p>火绒安全论坛：<a href="http://bbs.huorong.cn/forum-59-1.html" target="_blank" rel="noopener">http://bbs.huorong.cn/forum-59-1.html</a></p>
<p>爱毒霸社区：<a href="http://bbs.duba.net" target="_blank" rel="noopener">http://bbs.duba.net</a></p>
<p>腾讯电脑管家：<a href="http://bbs.guanjia.qq.com/forum-2-1.html" target="_blank" rel="noopener">http://bbs.guanjia.qq.com/forum-2-1.html</a></p>
<h4 id="2-4-在线病毒扫描网站"><a href="#2-4-在线病毒扫描网站" class="headerlink" title="2.4 在线病毒扫描网站"></a>2.4 在线病毒扫描网站</h4><p><a href="http://www.virscan.org" target="_blank" rel="noopener">http://www.virscan.org</a>         //多引擎在线病毒扫描网 v1.02，当前支持 41 款杀毒引擎     </p>
<p><a href="https://habo.qq.com" target="_blank" rel="noopener">https://habo.qq.com</a>             //腾讯哈勃分析系统</p>
<p><a href="https://virusscan.jotti.org" target="_blank" rel="noopener">https://virusscan.jotti.org</a>      //Jotti恶意软件扫描系统</p>
<p><a href="http://www.scanvir.com" target="_blank" rel="noopener">http://www.scanvir.com</a>        //针对计算机病毒、手机病毒、可疑文件等进行检测分析</p>
<h4 id="2-5-webshell查杀"><a href="#2-5-webshell查杀" class="headerlink" title="2.5 webshell查杀"></a>2.5 webshell查杀</h4><p>D盾_Web查杀：<a href="http://www.d99net.net/index.asp" target="_blank" rel="noopener">http://www.d99net.net/index.asp</a></p>
<p>河马webshell查杀：<a href="http://www.shellpub.com" target="_blank" rel="noopener">http://www.shellpub.com</a></p>
<p>深信服Webshell网站后门检测工具：<a href="http://edr.sangfor.com.cn/backdoor_detection.html" target="_blank" rel="noopener">http://edr.sangfor.com.cn/backdoor_detection.html</a></p>
<p>Safe3：<a href="http://www.uusec.com/webshell.zip" target="_blank" rel="noopener">http://www.uusec.com/webshell.zip</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/系统安全/">系统安全</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-本地计算机策略配置案例" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2019/08/28/本地计算机策略配置案例/" class="article-date">
      <time datetime="2019-08-27T16:00:00.000Z" itemprop="datePublished">2019-08-28</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2019/08/28/本地计算机策略配置案例/">组策略与安全设置</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <a id="more"></a>

<p><strong>组策略与安全设置</strong></p>
<p>组策略是一个能够让系统管理员控制管理用户工作环境的技术，包含计算机配置与用户配置两部份。其中计算机配置只对计算机环境有影响，而用户配置只对用户工作环境有影响。可以通过以下两种途径来设置组策略：</p>
<p><strong>本地计算机策略：</strong>用来设置某一计算机的策略，这个策略的计算机配置只会被应用到这台计算机，而用户配置会被应用到在此计算机登录的所有用户。</p>
<p><strong>域内的策略：</strong>在域内可以针对站点、域或组织单元来设置组策略，其中的域组策略内的设置会被应用到域内所有计算机与用户，而组织单元的组策略会被应用到该组织单元内的所有计算机与用户。</p>
<p><strong>对于加入到域的计算机来说，如果两者有冲突，以域或组织单元组策略的设置优先，本地策略无效。</strong></p>
<h1 id="一、-本地计算机策略配置案例"><a href="#一、-本地计算机策略配置案例" class="headerlink" title="一、**本地计算机策略配置案例**"></a><strong>一、**</strong>本地计算机策略配置案例**</h1><h2 id="1-、计算机配置"><a href="#1-、计算机配置" class="headerlink" title="1**、计算机配置**"></a><strong>1**</strong>、计算机配置**</h2><h3 id="案例1"><a href="#案例1" class="headerlink" title="案例1"></a><strong>案例1</strong></h3><p>****当要将windows server 2008计算机关机时，系统会要求提供关机理由。通过本地策略设置关闭提供关机理由。在开机时不显示管理您的服务器页</p>
<p><strong>操作流程：</strong>开始—运行—gpedit.msc （本地组策略编辑器）—-计算机配置—管理模板—-系统—</p>
<p>显示关闭事件跟踪程序—已禁用</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ft84lxctj30c90b1t96.jpg" alt="\img"></p>
<p>开机之后显示的：</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ft8hrs72j30da076t8w.jpg" alt="\img"></p>
<h3 id="案例2：开机不显示三键"><a href="#案例2：开机不显示三键" class="headerlink" title="案例2：开机不显示三键"></a><strong>案例2：</strong>开机不显示三键</h3><p><strong>操作流程：</strong>计算机配置–&gt;Windows设置–&gt;安全设置–&gt;本地策略，这时在本地策略下面可见到有“安全选项”，点击“安全选项”在右侧的框内找到“交互式登录:无须按CTRL+ALT+DEL”</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ft8qgknkj30fe06fdge.jpg" alt="\img"> </p>
<h2 id="2、-用户配置"><a href="#2、-用户配置" class="headerlink" title="2、**用户配置**"></a><strong>2、**</strong>用户配置**</h2><h3 id="案例1：删除开始菜单中的关机、重启、睡眠、休眠"><a href="#案例1：删除开始菜单中的关机、重启、睡眠、休眠" class="headerlink" title="案例1：删除开始菜单中的关机、重启、睡眠、休眠"></a><strong>案例1：</strong>删除开始菜单中的关机、重启、睡眠、休眠</h3><p><strong>操作流程：</strong>用户配置–管理模板–开始菜单和工具栏–双击右边的删除并阻止访问关机、重启、睡眠、休眠—选择已启用</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ft990u70j30ii03gaaa.jpg" alt="\img"></p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ft9h894dj30c403twem.jpg" alt="\img"></p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ft9o9op6j30c803bt8n.jpg" alt="\img"></p>
<h3 id="案例2：删除IE因特网选项的安全与连接选项卡"><a href="#案例2：删除IE因特网选项的安全与连接选项卡" class="headerlink" title="案例2：删除IE因特网选项的安全与连接选项卡"></a><strong>案例2：</strong>删除IE因特网选项的安全与连接选项卡</h3><p><strong>操作流程：</strong>用户配置–管理模板–windows组件–IE–internet控制面板–</p>
<p>​          分别双击禁用连接页与禁用安全页—已启用</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ftauhjk5j308207hq33.jpg" alt="\img"></p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ftc3c4p6j30fd03wwem.jpg" alt="\img"></p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ftccxe5jj30980630su.jpg" alt="\img"></p>
<p>​                    <img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ftcqox63j308v05zwel.jpg" alt="\img">少了安全和连接</p>
<h3 id="案例3：隐藏windows-防火墙"><a href="#案例3：隐藏windows-防火墙" class="headerlink" title="案例3：隐藏windows 防火墙"></a><strong>案例3：</strong>隐藏windows 防火墙</h3><p><strong>操作流程：</strong>用户配置–管理模板–控制面板–隐藏指定的控制面板–已启用–显示–添加–输入：windows 防火墙–单击三次确定</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ftd36quij30fe04u74c.jpg" alt="\img"></p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ftd9v4l5j30fe05idfy.jpg" alt="\img"></p>
<h1 id="二、-域组策略配置案例"><a href="#二、-域组策略配置案例" class="headerlink" title="二、**域组策略配置案例**"></a><strong>二、**</strong>域组策略配置案例**</h1><h1 id="三、"><a href="#三、" class="headerlink" title="三、"></a><strong>三、</strong><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ftdhdx55j30bx050dfy.jpg" alt="\img"></h1><h2 id="案例1：禁止生产部用户运行IE浏览器，生产部经理除外。"><a href="#案例1：禁止生产部用户运行IE浏览器，生产部经理除外。" class="headerlink" title="案例1：禁止生产部用户运行IE浏览器，生产部经理除外。"></a><strong>案例1：</strong>禁止生产部用户运行IE浏览器，生产部经理除外。</h2><p><strong>操作流程：</strong>用户配置–管理模板–系统–不要运行指定的windows应用程序–已启用–显示–添加–输入：iexplore.exe–单击3次确定</p>
<p>​          <strong>注意：**</strong>阻止继承与强制**</p>
<p>​          组策略例外排除：委派–高级–添加用户–拒绝读取、应用策略</p>
<h1 id="四、-本地安全策略配置案例"><a href="#四、-本地安全策略配置案例" class="headerlink" title="四、**本地安全策略配置案例**"></a><strong>四、**</strong>本地安全策略配置案例**</h1><p>   <strong>开始–管理工具–本地安全策略</strong></p>
<h2 id="1-、帐户策略的设置-：密码策略、帐户锁定策略"><a href="#1-、帐户策略的设置-：密码策略、帐户锁定策略" class="headerlink" title="1**、帐户策略的设置**：密码策略、帐户锁定策略"></a><strong>1**</strong>、帐户策略的设置**：密码策略、帐户锁定策略</h2><h2 id="2-、本地策略："><a href="#2-、本地策略：" class="headerlink" title="2**、本地策略：**"></a><strong>2**</strong>、本地策略：**</h2><p><strong>（1）用户权限分配：</strong>允许本地登录、拒绝本地登录、允许用户直接在本台计算机上按ctrl+alt+del键、</p>
<p>将工作站添加到域、关闭系统、更改系统时间…..</p>
<p>（2）<strong>安全选项：</strong>交互登录：无须按ctrl+alt+del键、不显示最后的用户名、提示用户密码过期前更改密码、试图登录的用户的消息文本、试图登录的用户的消息标题…..</p>
<h1 id="五、-域与域控制器安全策略"><a href="#五、-域与域控制器安全策略" class="headerlink" title="五、**域与域控制器安全策略**"></a><strong>五、**</strong>域与域控制器安全策略**</h1><p><strong>开始–管理工具–组策略管理</strong></p>
<h2 id="1-、域安全策略的设置"><a href="#1-、域安全策略的设置" class="headerlink" title="1**、域安全策略的设置**"></a><strong>1**</strong>、域安全策略的设置**</h2><p>（1）本地安全策略与域安全策略有冲突，以域安全策略优先，本地设置无效。</p>
<p>（2）本地计算机何时才会应用在域策略内有变动的设置呢？</p>
<p>本地安全策略有变动时；</p>
<p>本地计算机重启时；</p>
<p>DC每5分钟自动应用；</p>
<p>不是DC每隔90-120分钟会自动应用；</p>
<p>所有计算机每隔16小时强制应用，即使无更改。</p>
<p>手动应用域策略：gpupdate或gpupdate /force</p>
<h2 id="2-、域控制器安全策略的设置"><a href="#2-、域控制器安全策略的设置" class="headerlink" title="2**、域控制器安全策略的设置**"></a><strong>2**</strong>、域控制器安全策略的设置**</h2><p>只影响到位于Domain Controllers内的域控制器，不影响其他组织单元或容器内的计算机和用户</p>
<p>所有位于Domain Controllers内的DC都会受域控制器安全策略的影响。</p>
<p>域安全策略与域控制器安全策略冲突时，对于DC来说域控制器安全策略优先，域安全策略无效。</p>
<p>域控制器安全策略的设置必须要应用到域控制器后，对DC才生效。</p>
<h1 id="六、-组策略首选项"><a href="#六、-组策略首选项" class="headerlink" title="六、**组策略首选项**"></a><strong>六、**</strong>组策略首选项**</h1><p>​                            组策略内的设置分为，策略与首选项，区别是：</p>
<p>​     只有域内的组策略才有首选项功能，本地计算机策略无此功能。</p>
<p>​     首选项非强制性，客户端可更改设置，策略设置是强制性，客户端无法更改。</p>
<p>​     策略设置若要在客户端发生作用，客户计算机的操作系统或应用程序必须支持组策略，首选项不需要。</p>
<p>​     若要筛选策略设置，必须针对整个GPO来筛选，而首选项可以针对单一设置项目来设置。</p>
<h2 id="案例1-1"><a href="#案例1-1" class="headerlink" title="案例1"></a><strong>案例1</strong></h2><p>业务部所有用户登录时，其磁盘Z：会自动连接到\server\tools共享文件夹；另外还要使用筛选功能来设置只有业务部的用户paul登录时，其磁盘Y:会连接到\server\database共享文件夹，而业务部的其他用户登录时不会Y：磁盘。</p>
<p><strong>操作流程：</strong>组策略–用户配置–首选项–windows设置–右击驱动器映射–新建驱动器映射–操作：更新–位置：共享文件夹的路径–重新连接：打钩–驱动器号：Z—公用—在登录用户的安全上下文件中运行（用户策略选项）</p>
<p>​           组策略–用户配置–首选项–windows设置–右击驱动器映射–新建驱动器映射–操作：更瓣–位置：共享文件夹的路径–重新连接：打钩–驱动器号：Y—公用—在登录用户的安全上下文件中运行（用户策略选项）,项目级别目标—目标—新建项目–用户</p>
<h2 id="案例2"><a href="#案例2" class="headerlink" title="案例2"></a><strong>案例2</strong></h2><p>让业务部用户登录时会自动连接网络打印机</p>
<p><strong>操作流程：</strong>用户配置–首选项–控制面板设置–右击打印机–新建–共享打印机    </p>
<h1 id="七、-审核资源的使用"><a href="#七、-审核资源的使用" class="headerlink" title="七、**审核资源的使用**"></a><strong>七、**</strong>审核资源的使用**</h1><p>通过审核（auditing)可以让系统管理员来跟踪是否有用户访问计算机内的资源、跟踪计算机运行情况等。审核工作通常需要经过以下两个步骤：</p>
<p><strong>启用审核策略：</strong>Administrators成员才有权限</p>
<p><strong>设置将要审核的资源：</strong>必须有管理审核及安全日志权限的用户才可以审核资源，默认是 Administrators成员才有此权限。</p>
<p><strong>审核策略的设置：</strong>本地安全策略–安全设置–本地策略–审核策略</p>
<p><strong>查看安全日志文件：</strong>管理工具–事件查看器–windows日志–安全</p>
<p>​                           <strong>案例1：审核登录事件</strong></p>
<p><strong>案例2：审核文件的访问行为</strong></p>
<p><strong>案例3：审核打印机的访问行为</strong></p>
<p><strong>案例4：审核目录访问行为</strong></p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ftdrjnyjj30a7056weq.jpg" alt="\img"></p>
<h1 id="八、-任务"><a href="#八、-任务" class="headerlink" title="八、 任务"></a>八、 任务</h1><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><ol>
<li><p>域用户登录桌面后自动加入本地administrators管理员组</p>
</li>
<li><p>域用户登录桌面后自动禁用本地guest来宾用户</p>
</li>
<li><p>域用户登录桌面后控制面板隐藏用户账户</p>
</li>
<li><p>域用户登录桌面后自动创建公司共享快捷方式</p>
</li>
<li><p>域用户登录桌面后自动创建百度网页快捷方式URL</p>
</li>
<li><p>域用户登录桌面后自动创建驱动器映射公司共享</p>
</li>
<li><p>域用户登录桌面后禁用计算管理的本地用户和组</p>
</li>
<li><p>域用户登录桌面后自动推送批处理安装压缩包软件</p>
</li>
<li><p>域用户登录桌面后提示组策略限制安装QQ软件</p>
</li>
</ol>
<h2 id="参考答案："><a href="#参考答案：" class="headerlink" title="参考答案："></a><strong>参考答案：</strong></h2><p>1、域用户登录桌面后自动加入本地administrators管理员组</p>
<p>编辑组策略–用户配置–首选项–控制面板设置–本地用户和组–新建–本地组。</p>
<p>   本地组–操作选择更新–组名选择Administrators(内置)–选择添加当前用户–确定</p>
<p>域控服务器运行输入 gpupdate /force刷新服务器组策略，客户端需要注销系统后使用域用户登录</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6fsy8npdqj30bu07mq38.jpg" alt="\img"></p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6fsyfxwvjj30c20cft98.jpg" alt="\img"></p>
<p>2、域用户登录桌面后自动禁用本地guest来宾用户</p>
<p>编辑组策略– 用户配置–首选项–控制面板设置–本地用户和组–新建 –本地用户</p>
<p>本地用户 –操作选择更新 –用户名选择guest(内置) –选择账户已禁用 –确定。</p>
<p>域控服务器运行输入 gpupdate /force刷新服务器组策略，客户端需要注销系统后使用域用户登录</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6fsz8l4e9j308q08ydg2.jpg" alt="\img"></p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6fszfakevj309t076jrg.jpg" alt="\img"></p>
<p>3、 域用户登录桌面后控制面板隐藏用户账户</p>
<p>编辑组策略 —- 用户配置 —- 管理模板 —- 控制面板 —- 双击打开 隐藏的指定的“控制面板”项。</p>
<p>选择已启用 —- 显示 —- 输入 Microsoft.UserAccounts —- 确定 —- 确定。</p>
<p>域控服务器运行输入 gpupdate /force刷新服务器组策略，客户端需要注销系统后使用域用户登录</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6fszrhv6kj30a507h0sy.jpg" alt="\img"></p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ft06i3xnj30be06sjro.jpg" alt="\img"></p>
<p>4、域用户登录桌面后自动创建公司共享快捷方式</p>
<p> 编辑组策略 —- 用户配置 —- Windows 设置 —- 快捷方式 —– 新建 —– 快捷方式。</p>
<p>在域控服务器创建一个共享文件夹2345，目标路径填写\192.168.10.30\2345 域控服务器的共享文件夹。</p>
<p>域控服务器运行输入 gpupdate /force刷新服务器组策略，客户端需要注销系统后使用域用户登录</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ft10xym5j308c08it91.jpg" alt="\img"></p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ft186u3bj30b305xjrf.jpg" alt="\img"></p>
<p>5、域用户登录桌面后自动创建百度网页快捷方式URL</p>
<p>编辑组策略 —- 用户配置 —-  首选项 —- Windows 设置 —- 快捷方式 —- 新建  —- 快捷方式。</p>
<p>操作选择创建–名称自定义–目标类型选择URL–位置桌面 –目标URL输入<a href="http://www.baidu.com/" target="_blank" rel="noopener">www.baidu.com</a> –图标文件路径自定义选择–确定。</p>
<p>域控服务器运行输入 gpupdate /force刷新服务器组策略，客户端需要注销系统后使用域用户登录</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ft1h3oh8j30a805vmx9.jpg" alt="\img"></p>
<p>6、域用户登录桌面后自动创建驱动器映射公司共享</p>
<p>编辑组策略 —- 用户配置 —-  首选项 —- Windows 设置 —- 驱动器映射 —- 新建 —- 映射驱动器</p>
<p>常规 —- 操作选择创建  —- 位置输入公司共享服务器地址 <a href="file://192.168.10.30/2345" target="_blank" rel="noopener">\192.168.10.30\2345</a>  驱动器号自定义 —- 隐藏/显示此驱动器选择显示此驱动器 —- 确定。</p>
<p>域控服务器运行输入 gpupdate /force刷新服务器组策略，客户端需要注销系统后使用域用户登录</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ft1umo7zj308o08qwer.jpg" alt="\img"></p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ft20vq8kj30b808o0t1.jpg" alt="\img"></p>
<p>7、域用户登录桌面后禁用计算管理的本地用户和组</p>
<p>域用户登录桌面后禁用计算管理的本地用户和组编辑组策略 —- 用户配置 —- 策略 —- 管理模板 —- Windows 组件 —- Microsoft管理控制台 — 受限的/许可</p>
<p>的管理单元 —- 本地用户和组。</p>
<p>选择已禁用 —- 确定</p>
<p>域控服务器运行输入 gpupdate /force刷新服务器组策略，客户端需要注销系统后使用域用户登录</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ft2jd3b1j30m204umxf.jpg" alt="\img"></p>
<p>8、域用户登录桌面后自动推送批处理安装压缩包软件</p>
<p>编辑组策略 —- 选择用户配置—策略 —- Windows设置 — 脚本(登录/注销) —- 双击打开登录</p>
<p>点击显示文件 —- 把桌面编辑好的test.bat批处理复制到组组策略脚本指定的文件夹里面。(test.bat批处理 start <a href="file://192.168.10.30/2345/360压缩包.exe" target="_blank" rel="noopener">\192.168.10.30\2345\360压缩包.exe)</a>)</p>
<p>域控服务器运行输入 gpupdate /force刷新服务器组策略，客户端需要注销系统后使用域用户登录，实现功能如下图所示。</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ft2ryvs8j30e00640sv.jpg" alt="\img"></p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ft2ybo28j30af04eq2s.jpg" alt="\img"></p>
<p>9、域用户登录桌面后提示组策略限制安装QQ软件</p>
<p>编辑策略– 用户配置– –策略–Windows 设置– 安全设置–软件限制策略—右键其它规则–选择新建哈希规则 。</p>
<p>选择浏览 — 选择要限制的软件 —- 打开 —- 安全级别选择：不允许 —– 确定。</p>
<p>域控服务器运行输入 gpupdate /force刷新服务器组策略，客户端需要注销系统后使用域用户登录</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ft377vpdj30b208pwew.jpg" alt="\img"></p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ft3ep884j30h004sq31.jpg" alt="\img"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/系统安全/">系统安全</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-08-28windows服务器" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2019/08/26/08-28windows服务器/" class="article-date">
      <time datetime="2019-08-25T16:00:00.000Z" itemprop="datePublished">2019-08-26</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2019/08/26/08-28windows服务器/">Windows服务器</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <p>本节主要简单的介绍了windows2008R2与XP服务器的一些简单的操作</p>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/系统安全/">系统安全</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a   href="/2019/08/26/08-28windows服务器/#more">查看更多 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-第2篇：Linux入侵排查" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2019/08/25/第2篇：Linux入侵排查/" class="article-date">
      <time datetime="2019-08-25T08:20:20.000Z" itemprop="datePublished">2019-08-25</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2019/08/25/第2篇：Linux入侵排查/">linux入侵排查</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <a id="more"></a>

<h2 id="第2篇：Linux入侵排查"><a href="#第2篇：Linux入侵排查" class="headerlink" title="第2篇：Linux入侵排查"></a>第2篇：Linux入侵排查</h2><h3 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h3><p>当企业发生黑客入侵、系统崩溃或其它影响业务正常运行的安全事件时，急需第一时间进行处理，使企业的网络信息系统在最短时间内恢复正常工作，进一步查找入侵来源，还原入侵事故过程，同时给出解决方案与防范措施，为企业挽回或减少经济损失。  </p>
<p>针对常见的攻击事件，结合工作中应急响应事件分析和解决的方法，总结了一些Linux服务器入侵排查的思路。</p>
<h3 id="0x01-入侵排查思路"><a href="#0x01-入侵排查思路" class="headerlink" title="0x01 入侵排查思路"></a>0x01 入侵排查思路</h3><h4 id="1-1-账号安全"><a href="#1-1-账号安全" class="headerlink" title="1.1 账号安全"></a>1.1 账号安全</h4><p><strong>基本使用：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1、用户信息文件/etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">account:password:UID:GID:GECOS:directory:shell</span><br><span class="line">用户名：密码：用户ID：组ID：用户说明：家目录：登陆之后shell</span><br><span class="line">注意：无密码只允许本机登陆，远程不允许登陆</span><br><span class="line"></span><br><span class="line">2、影子文件/etc/shadow</span><br><span class="line">root:$6$oGs1PqhL2p3ZetrE$X7o7bzoouHQVSEmSgsYN5UD4.kMHx6qgbTqwNVC5oOAouXvcjQSt.Ft7ql1WpkopY0UV9ajBwUt1DpYxTCVvI/:16809:0:99999:7:::</span><br><span class="line">用户名：加密密码：密码最后一次修改日期：两次密码的修改时间间隔：密码有效期：密码修改到期到的警告天数：密码过期之后的宽限天数：账号失效时间：保留</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">who     查看当前登录用户（tty本地登陆  pts远程登录）</span><br><span class="line">w       查看系统信息，想知道某一时刻用户的行为</span><br><span class="line">uptime  查看登陆多久、多少用户，负载</span><br></pre></td></tr></table></figure>

<p><strong>入侵排查：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1、查询特权用户特权用户(uid 为0)</span><br><span class="line">[root@localhost ~]# awk -F: &apos;$3==0&#123;print $1&#125;&apos; /etc/passwd</span><br><span class="line">2、查询可以远程登录的帐号信息</span><br><span class="line">[root@localhost ~]# awk &apos;/\$1|\$6/&#123;print $1&#125;&apos; /etc/shadow</span><br><span class="line">3、除root帐号外，其他帐号是否存在sudo权限。如非管理需要，普通帐号应删除sudo权限</span><br><span class="line">[root@localhost ~]# more /etc/sudoers | grep -v &quot;^#\|^$&quot; | grep &quot;ALL=(ALL)&quot;</span><br><span class="line">4、禁用或删除多余及可疑的帐号</span><br><span class="line">    usermod -L user    禁用帐号，帐号无法登录，/etc/shadow第二栏为!开头</span><br><span class="line">	userdel user       删除user用户</span><br><span class="line">	userdel -r user    将删除user用户，并且将/home目录下的user目录一并删除</span><br></pre></td></tr></table></figure>

<h4 id="1-2-历史命令"><a href="#1-2-历史命令" class="headerlink" title="1.2 历史命令"></a>1.2 历史命令</h4><p><strong>基本使用：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">通过.bash_history查看帐号执行过的系统命令</span><br><span class="line">1、root的历史命令</span><br><span class="line">histroy</span><br><span class="line">2、打开/home各帐号目录下的.bash_history，查看普通帐号的历史命令</span><br><span class="line"></span><br><span class="line">为历史的命令增加登录的IP地址、执行命令时间等信息：</span><br><span class="line">1）保存1万条命令</span><br><span class="line">sed -i &apos;s/^HISTSIZE=1000/HISTSIZE=10000/g&apos; /etc/profile</span><br><span class="line">2）在/etc/profile的文件尾部添加如下行数配置信息：</span><br><span class="line">######jiagu history xianshi#########</span><br><span class="line">USER_IP=`who -u am i 2&gt;/dev/null | awk &apos;&#123;print $NF&#125;&apos; | sed -e &apos;s/[()]//g&apos;`</span><br><span class="line">if [ &quot;$USER_IP&quot; = &quot;&quot; ]</span><br><span class="line">then</span><br><span class="line">USER_IP=`hostname`</span><br><span class="line">fi</span><br><span class="line">export HISTTIMEFORMAT=&quot;%F %T $USER_IP `whoami` &quot;</span><br><span class="line">shopt -s histappend</span><br><span class="line">export PROMPT_COMMAND=&quot;history -a&quot;</span><br><span class="line">######### jiagu history xianshi ##########</span><br><span class="line">3）source /etc/profile让配置生效</span><br><span class="line"></span><br><span class="line">生成效果： 1  2018-07-10 19:45:39 192.168.204.1 root source /etc/profile</span><br><span class="line"></span><br><span class="line">3、历史操作命令的清除：history -c</span><br><span class="line">但此命令并不会清除保存在文件中的记录，因此需要手动删除.bash_profile文件中的记录。</span><br></pre></td></tr></table></figure>

<p><strong>入侵排查：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">进入用户目录下</span><br><span class="line">cat .bash_history &gt;&gt; history.txt</span><br></pre></td></tr></table></figure>

<h4 id="1-3-检查异常端口"><a href="#1-3-检查异常端口" class="headerlink" title="1.3 检查异常端口"></a>1.3 检查异常端口</h4><p>使用netstat 网络连接命令，分析可疑端口、IP、PID</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">netstat -antlp|more</span><br><span class="line"></span><br><span class="line">查看下pid所对应的进程文件路径，</span><br><span class="line">运行ls -l /proc/$PID/exe或file /proc/$PID/exe（$PID 为对应的pid 号）</span><br></pre></td></tr></table></figure>

<h4 id="1-4-检查异常进程"><a href="#1-4-检查异常进程" class="headerlink" title="1.4 检查异常进程"></a>1.4 检查异常进程</h4><p>使用ps命令，分析进程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep pid</span><br></pre></td></tr></table></figure>

<h4 id="1-5-检查开机启动项"><a href="#1-5-检查开机启动项" class="headerlink" title="1.5 检查开机启动项"></a>1.5 检查开机启动项</h4><p><strong>基本使用：</strong></p>
<p>系统运行级别示意图：</p>
<table>
<thead>
<tr>
<th align="center">运行级别</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0</td>
<td align="center">关机</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">单用户模式，可以想象为windows的安全模式，主要用于系统修复</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">不完全的命令行模式，不含NFS服务</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">完全的命令行模式，就是标准字符界面</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">系统保留</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">图形模式</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">重启动</td>
</tr>
</tbody></table>
<p>查看运行级别命令<br>    runlevel   </p>
<p>系统默认允许级别</p>
<pre><code>vi  /etc/inittab
id=3：initdefault  系统开机后直接进入哪个运行级别</code></pre><p>开机启动配置文件</p>
<pre><code>/etc/rc.local
/etc/rc.d/rc[0~6].d</code></pre><p>例子:当我们需要开机启动自己的脚本时，只需要将可执行脚本丢在/etc/init.d目录下，然后在/etc/rc.d/rc*.d中建立软链接即可</p>
<pre><code>root@localhost ~]# ln -s /etc/init.d/sshd /etc/rc.d/rc3.d/S100ssh</code></pre><p>此处sshd是具体服务的脚本文件，S100ssh是其软链接，S开头代表加载时自启动；如果是K开头的脚本文件，代表运行级别加载时需要关闭的。</p>
<p><strong>入侵排查：</strong></p>
<p>启动项文件：<br>    more /etc/rc.local<br>    /etc/rc.d/rc[0~6].d<br>    ls -l /etc/rc.d/rc3.d/</p>
<h4 id="1-6-检查定时任务"><a href="#1-6-检查定时任务" class="headerlink" title="1.6 检查定时任务"></a>1.6 检查定时任务</h4><p><strong>基本使用</strong></p>
<p>1、利用crontab创建计划任务</p>
<ul>
<li>基本命令</li>
</ul>
<p>crontab -l   列出某个用户cron服务的详细内容</p>
<p>Tips：默认编写的crontab文件会保存在 (/var/spool/cron/用户名 例如: /var/spool/cron/root</p>
<p>crontab -r   删除每个用户cront任务(谨慎：删除所有的计划任务)</p>
<p>crontab -e   使用编辑器编辑当前的crontab文件 </p>
<p>如：*/1 * * * * echo “hello world” &gt;&gt; /tmp/test.txt 每分钟写入文件</p>
<p>2、利用anacron实现异步定时任务调度</p>
<ul>
<li>使用案例</li>
</ul>
<p>每天运行 /home/backup.sh脚本：<br>    vi /etc/anacrontab<br>    @daily    10    example.daily   /bin/bash /home/backup.sh</p>
<p>当机器在 backup.sh 期望被运行时是关机的，anacron会在机器开机十分钟之后运行它，而不用再等待 7天。</p>
<p><strong>入侵排查</strong></p>
<p>重点关注以下目录中是否存在恶意脚本</p>
<pre><code>/var/spool/cron/* 
/etc/crontab
/etc/cron.d/*
/etc/cron.daily/* 
/etc/cron.hourly/* 
/etc/cron.monthly/*
/etc/cron.weekly/
/etc/anacrontab
/var/spool/anacron/*</code></pre><p>小技巧：</p>
<pre><code>more /etc/cron.daily/*  查看目录下所有文件</code></pre><h4 id="1-7-检查服务"><a href="#1-7-检查服务" class="headerlink" title="1.7 检查服务"></a>1.7 检查服务</h4><p><strong>服务自启动</strong></p>
<p>第一种修改方法：</p>
<pre><code>chkconfig [--level 运行级别] [独立服务名] [on|off]
chkconfig –level  2345 httpd on  开启自启动
chkconfig httpd on （默认level是2345）</code></pre><p>第二种修改方法：</p>
<pre><code>修改/etc/re.d/rc.local 文件  
加入 /etc/init.d/httpd start</code></pre><p>第三种修改方法：</p>
<p>使用ntsysv命令管理自启动，可以管理独立服务和xinetd服务。</p>
<p><strong>入侵排查</strong></p>
<p>1、查询已安装的服务：</p>
<p>RPM包安装的服务</p>
<pre><code>chkconfig  --list  查看服务自启动状态，可以看到所有的RPM包安装的服务
ps aux | grep crond 查看当前服务

系统在3与5级别下的启动项 
中文环境
chkconfig --list | grep &quot;3:启用\|5:启用&quot;
英文环境
chkconfig --list | grep &quot;3:on\|5:on&quot;</code></pre><p>源码包安装的服务</p>
<pre><code>查看服务安装位置 ，一般是在/user/local/
service httpd start
搜索/etc/rc.d/init.d/  查看是否存在</code></pre><h4 id="1-8-检查异常文件"><a href="#1-8-检查异常文件" class="headerlink" title="1.8 检查异常文件"></a>1.8 检查异常文件</h4><p>1、查看敏感目录，如/tmp目录下的文件，同时注意隐藏文件夹，以“..”为名的文件夹具有隐藏属性</p>
<p>2、得到发现WEBSHELL、远控木马的创建时间，如何找出同一时间范围内创建的文件？</p>
<p>​    可以使用find命令来查找，如 find /opt -iname “*” -atime 1 -type f  找出 /opt 下一天前访问过的文件</p>
<p>3、针对可疑文件可以使用stat进行创建修改时间。</p>
<h4 id="1-9-检查系统日志"><a href="#1-9-检查系统日志" class="headerlink" title="1.9 检查系统日志"></a>1.9 检查系统日志</h4><p>日志默认存放位置：/var/log/</p>
<p>查看日志配置情况：more /etc/rsyslog.conf</p>
<table>
<thead>
<tr>
<th align="center">日志文件</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">/var/log/cron</td>
<td align="center">记录了系统定时任务相关的日志</td>
</tr>
<tr>
<td align="center">/var/log/cups</td>
<td align="center">记录打印信息的日志</td>
</tr>
<tr>
<td align="center">/var/log/dmesg</td>
<td align="center">记录了系统在开机时内核自检的信息，也可以使用dmesg命令直接查看内核自检信息</td>
</tr>
<tr>
<td align="center">/var/log/mailog</td>
<td align="center">记录邮件信息</td>
</tr>
<tr>
<td align="center">/var/log/message</td>
<td align="center">记录系统重要信息的日志。这个日志文件中会记录Linux系统的绝大多数重要信息，如果系统出现问题时，首先要检查的就应该是这个日志文件</td>
</tr>
<tr>
<td align="center">/var/log/btmp</td>
<td align="center">记录错误登录日志，这个文件是二进制文件，不能直接vi查看，而要使用lastb命令查看</td>
</tr>
<tr>
<td align="center">/var/log/lastlog</td>
<td align="center">记录系统中所有用户最后一次登录时间的日志，这个文件是二进制文件，不能直接vi，而要使用lastlog命令查看</td>
</tr>
<tr>
<td align="center">/var/log/wtmp</td>
<td align="center">永久记录所有用户的登录、注销信息，同时记录系统的启动、重启、关机事件。同样这个文件也是一个二进制文件，不能直接vi，而需要使用last命令来查看</td>
</tr>
<tr>
<td align="center">/var/log/utmp</td>
<td align="center">记录当前已经登录的用户信息，这个文件会随着用户的登录和注销不断变化，只记录当前登录用户的信息。同样这个文件不能直接vi，而要使用w,who,users等命令来查询</td>
</tr>
<tr>
<td align="center">/var/log/secure</td>
<td align="center">记录验证和授权方面的信息，只要涉及账号和密码的程序都会记录，比如SSH登录，su切换用户，sudo授权，甚至添加用户和修改用户密码都会记录在这个日志文件中</td>
</tr>
</tbody></table>
<p>日志分析技巧：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1、定位有多少IP在爆破主机的root帐号：    </span><br><span class="line">grep &quot;Failed password for root&quot; /var/log/secure | awk &apos;&#123;print $11&#125;&apos; | sort | uniq -c | sort -nr | more</span><br><span class="line"></span><br><span class="line">定位有哪些IP在爆破：</span><br><span class="line">grep &quot;Failed password&quot; /var/log/secure|grep -E -o &quot;(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)&quot;|uniq -c</span><br><span class="line"></span><br><span class="line">爆破用户名字典是什么？</span><br><span class="line"> grep &quot;Failed password&quot; /var/log/secure|perl -e &apos;while($_=&lt;&gt;)&#123; /for(.*?) from/; print &quot;$1\n&quot;;&#125;&apos;|uniq -c|sort -nr</span><br><span class="line"> </span><br><span class="line">2、登录成功的IP有哪些： 	</span><br><span class="line">grep &quot;Accepted &quot; /var/log/secure | awk &apos;&#123;print $11&#125;&apos; | sort | uniq -c | sort -nr | more</span><br><span class="line"></span><br><span class="line">登录成功的日期、用户名、IP：</span><br><span class="line">grep &quot;Accepted &quot; /var/log/secure | awk &apos;&#123;print $1,$2,$3,$9,$11&#125;&apos; </span><br><span class="line"></span><br><span class="line">3、增加一个用户kali日志：</span><br><span class="line">Jul 10 00:12:15 localhost useradd[2382]: new group: name=kali, GID=1001</span><br><span class="line">Jul 10 00:12:15 localhost useradd[2382]: new user: name=kali, UID=1001, GID=1001, home=/home/kali</span><br><span class="line">, shell=/bin/bash</span><br><span class="line">Jul 10 00:12:58 localhost passwd: pam_unix(passwd:chauthtok): password changed for kali</span><br><span class="line">#grep &quot;useradd&quot; /var/log/secure </span><br><span class="line"></span><br><span class="line">4、删除用户kali日志：</span><br><span class="line">Jul 10 00:14:17 localhost userdel[2393]: delete user &apos;kali&apos;</span><br><span class="line">Jul 10 00:14:17 localhost userdel[2393]: removed group &apos;kali&apos; owned by &apos;kali&apos;</span><br><span class="line">Jul 10 00:14:17 localhost userdel[2393]: removed shadow group &apos;kali&apos; owned by &apos;kali&apos;</span><br><span class="line"># grep &quot;userdel&quot; /var/log/secure</span><br><span class="line"></span><br><span class="line">5、su切换用户：</span><br><span class="line">Jul 10 00:38:13 localhost su: pam_unix(su-l:session): session opened for user good by root(uid=0)</span><br><span class="line"></span><br><span class="line">sudo授权执行:</span><br><span class="line">sudo -l</span><br><span class="line">Jul 10 00:43:09 localhost sudo:    good : TTY=pts/4 ; PWD=/home/good ; USER=root ; COMMAND=/sbin/shutdown -r now</span><br></pre></td></tr></table></figure>

<h3 id="0x02-工具篇"><a href="#0x02-工具篇" class="headerlink" title="0x02 工具篇"></a>0x02 工具篇</h3><h4 id="2-1-Rootkit查杀"><a href="#2-1-Rootkit查杀" class="headerlink" title="2.1 Rootkit查杀"></a>2.1 Rootkit查杀</h4><ul>
<li><p>chkrootkit  </p>
<p>网址：<a href="http://www.chkrootkit.org" target="_blank" rel="noopener">http://www.chkrootkit.org</a> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">使用方法：</span><br><span class="line">wget ftp://ftp.pangeia.com.br/pub/seg/pac/chkrootkit.tar.gz</span><br><span class="line">tar zxvf chkrootkit.tar.gz</span><br><span class="line">cd chkrootkit-0.52</span><br><span class="line">make sense</span><br><span class="line">#编译完成没有报错的话执行检查</span><br><span class="line">./chkrootkit</span><br></pre></td></tr></table></figure>
</li>
<li><p>rkhunter</p>
<p>网址：<a href="http://rkhunter.sourceforge.net" target="_blank" rel="noopener">http://rkhunter.sourceforge.net</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">使用方法：</span><br><span class="line">Wget https://nchc.dl.sourceforge.net/project/rkhunter/rkhunter/1.4.4/rkhunter-1.4.4.tar.gz</span><br><span class="line">tar -zxvf rkhunter-1.4.4.tar.gz</span><br><span class="line">cd rkhunter-1.4.4</span><br><span class="line">./installer.sh --install</span><br><span class="line">rkhunter -c</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="2-2-病毒查杀"><a href="#2-2-病毒查杀" class="headerlink" title="2.2 病毒查杀"></a>2.2 病毒查杀</h4><ul>
<li><p>Clamav</p>
<p>ClamAV的官方下载地址为：<a href="http://www.clamav.net/download.html" target="_blank" rel="noopener">http://www.clamav.net/download.html</a> </p>
<p>安装方式一： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">1、安装zlib：</span><br><span class="line">wget http://nchc.dl.sourceforge.net/project/libpng/zlib/1.2.7/zlib-1.2.7.tar.gz </span><br><span class="line">tar -zxvf  zlib-1.2.7.tar.gz</span><br><span class="line">cd zlib-1.2.7</span><br><span class="line">#安装一下gcc编译环境： yum install gcc</span><br><span class="line">CFLAGS=&quot;-O3 -fPIC&quot; ./configure --prefix= /usr/local/zlib/</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">2、添加用户组clamav和组成员clamav：</span><br><span class="line">groupadd clamav</span><br><span class="line">useradd -g clamav -s /bin/false -c &quot;Clam AntiVirus&quot; clamav</span><br><span class="line"></span><br><span class="line">3、安装Clamav</span><br><span class="line">tar –zxvf clamav-0.97.6.tar.gz</span><br><span class="line">cd clamav-0.97.6</span><br><span class="line">./configure --prefix=/opt/clamav --disable-clamav -with-zlib=/usr/local/zlib</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line">4、配置Clamav</span><br><span class="line">mkdir /opt/clamav/logs</span><br><span class="line">mkdir /opt/clamav/updata</span><br><span class="line">touch /opt/clamav/logs/freshclam.log</span><br><span class="line">touch /opt/clamav/logs/clamd.log</span><br><span class="line">cd /opt/clamav/logs</span><br><span class="line">chown clamav:clamav clamd.log</span><br><span class="line">chown clamav:clamav freshclam.log</span><br><span class="line"></span><br><span class="line">5、ClamAV 使用：</span><br><span class="line"> /opt/clamav/bin/freshclam 升级病毒库</span><br><span class="line">./clamscan –h 查看相应的帮助信息</span><br><span class="line">./clamscan -r /home  扫描所有用户的主目录就使用</span><br><span class="line">./clamscan -r --bell -i /bin  扫描bin目录并且显示有问题的文件的扫描结果</span><br></pre></td></tr></table></figure>

<p>安装方式二： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#安装</span><br><span class="line">yum install -y clamav</span><br><span class="line">#更新病毒库</span><br><span class="line">freshclam</span><br><span class="line">#扫描方法</span><br><span class="line">clamscan -r /etc --max-dir-recursion=5 -l /root/etcclamav.log</span><br><span class="line">clamscan -r /bin --max-dir-recursion=5 -l /root/binclamav.log</span><br><span class="line">clamscan -r /usr --max-dir-recursion=5 -l /root/usrclamav.log</span><br><span class="line">#扫描并杀毒</span><br><span class="line">clamscan -r  --remove  /usr/bin/bsd-port</span><br><span class="line">clamscan -r  --remove  /usr/bin/</span><br><span class="line">clamscan -r --remove  /usr/local/zabbix/sbin</span><br><span class="line">#查看日志发现</span><br><span class="line">cat /root/usrclamav.log |grep FOUND</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="2-3-webshell查杀"><a href="#2-3-webshell查杀" class="headerlink" title="2.3 webshell查杀"></a>2.3 webshell查杀</h4><p>linux版：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">河马webshell查杀：http://www.shellpub.com</span><br><span class="line">深信服Webshell网站后门检测工具：http://edr.sangfor.com.cn/backdoor_detection.html</span><br></pre></td></tr></table></figure>

<h4 id="2-4-RPM-check检查"><a href="#2-4-RPM-check检查" class="headerlink" title="2.4 RPM check检查"></a>2.4 RPM check检查</h4><p>​    系统完整性可以通过rpm自带的-Va来校验检查所有的rpm软件包，查看哪些命令是否被替换了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./rpm -Va &gt; rpm.log</span><br></pre></td></tr></table></figure>

<p>如果一切均校验正常将不会产生任何输出，如果有不一致的地方，就会显示出来，输出格式是8位长字符串，每个字符都用以表示文件与RPM数据库中一种属性的比较结果 ，如果是. (点) 则表示测试通过。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">验证内容中的8个信息的具体内容如下：</span><br><span class="line">		S         文件大小是否改变</span><br><span class="line">		M         文件的类型或文件的权限（rwx）是否被改变</span><br><span class="line">		5         文件MD5校验是否改变（可以看成文件内容是否改变）</span><br><span class="line">		D         设备中，从代码是否改变</span><br><span class="line">		L         文件路径是否改变</span><br><span class="line">		U         文件的属主（所有者）是否改变</span><br><span class="line">		G         文件的属组是否改变</span><br><span class="line">		T         文件的修改时间是否改变</span><br></pre></td></tr></table></figure>

<p>如果命令被替换了，如果还原回来：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">文件提取还原案例：</span><br><span class="line">rpm  -qf /bin/ls  查询ls命令属于哪个软件包</span><br><span class="line">mv  /bin/ls /tmp  先把ls转移到tmp目录下，造成ls命令丢失的假象</span><br><span class="line">rpm2cpio /mnt/cdrom/Packages/coreutils-8.4-19.el6.i686.rpm | cpio -idv ./bin/ls 提取rpm包中ls命令到当前目录的/bin/ls下</span><br><span class="line">cp /root/bin/ls  /bin/ 把ls命令复制到/bin/目录 修复文件丢失</span><br></pre></td></tr></table></figure>

<h4 id="2-5-linux安全检查脚本"><a href="#2-5-linux安全检查脚本" class="headerlink" title="2.5 linux安全检查脚本"></a>2.5 linux安全检查脚本</h4><p>Github项目地址：</p>
<p><a href="https://github.com/grayddq/GScan" target="_blank" rel="noopener">https://github.com/grayddq/GScan</a></p>
<p><a href="https://github.com/ppabc/security_check" target="_blank" rel="noopener">https://github.com/ppabc/security_check</a></p>
<p><a href="https://github.com/T0xst/linux" target="_blank" rel="noopener">https://github.com/T0xst/linux</a></p>
<p><strong>尽信书不如无书，工具只是辅助，别太过于依赖，关键在于你如何解决问题的思路。</strong></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/系统安全/">系统安全</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-VPN" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2019/08/23/VPN/" class="article-date">
      <time datetime="2019-08-23T10:45:50.000Z" itemprop="datePublished">2019-08-23</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2019/08/23/VPN/">VPN</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <a id="more"></a>

<h1 id="一、VPN"><a href="#一、VPN" class="headerlink" title="一、VPN"></a>一、VPN</h1><h2 id="1、L2TP-VPN"><a href="#1、L2TP-VPN" class="headerlink" title="1、L2TP VPN"></a>1、L2TP VPN</h2><p>2TP是一种工业标准的Internet隧道协议，功能大致和PPTP协议类似，比如同样可以对网络数据流进行加密。不过也有不同之处，比如PPTP要求网络为IP网络，L2TP要求面向数据包的点对点连接；PPTP使用单一隧道，L2TP使用多隧道；L2TP提供包头压缩、隧道验证，而PPTP不支持。</p>
<h2 id="2、PPTP-VPN"><a href="#2、PPTP-VPN" class="headerlink" title="2、PPTP-VPN"></a>2、PPTP-VPN</h2><p>即点对点隧道协议。该协议是在PPP协议的基础上开发的一种新的增强型安全协议，支持多协议虚拟专用网（VPN），可以通过密码验证协议（PAP）、可扩展认证协议（EAP）等方法增强安全性。可以使远程用户通过拨入ISP、通过直接连接Internet或其他网络安全地访问企业网。</p>
<h2 id="3、IPsec-VPN"><a href="#3、IPsec-VPN" class="headerlink" title="3、IPsec-VPN"></a>3、IPsec-VPN</h2><p>互联网安全协议（英语：Internet Protocol Security，缩写为IPsec），是一个协议包，通过对IP协议的分组进行加密和认证来保护IP协议的网络传输协议族（一些相互关联的协议的集合）。 [1]<br>IPsec主要由以下协议组成：</p>
<p>一、认证头（AH），为IP数据报提供无连接数据完整性、消息认证以及防重放攻击保护；</p>
<p>二、封装安全载荷（ESP），提供机密性、数据源认证、无连接完整性、防重放和有限的传输流（traffic-flow）机密性；</p>
<p>三、安全关联（SA），提供算法和数据包，提供AH、ESP操作所需的参数。</p>
<p>IPsec协议工作在OSI模型的第三层，使其在单独使用时适于保护基于TCP或UDP的协议（如安全套接子层（SSL）就不能保护UDP层的通信流）。这就意味着，与传输层或更高层的协议相比，IPsec协议必须处理可靠性和分片的问题，这同时也增加了它的复杂性和处理开销。相对而言，SSL/TLS依靠更高层的TCP（OSI的第四层）来管理可靠性和分片。</p>
<h2 id="4、GRE-VPN"><a href="#4、GRE-VPN" class="headerlink" title="4、GRE VPN"></a>4、GRE VPN</h2><p>GRE是一种最传统的隧道协议，其根本功能就是要实现隧道功能，通过隧道连接的两<br>个远程网络就如同直连，GRE在两个远程网络之间模拟出直连链路,从而使网络间达到直<br>连的效果，为此，GRE需要完成多次封装,总共有3次</p>
<p>（1）接收原始IP数据包当作乘客协议,原始IR数据包包头的IP地址为私有IP地址</p>
<p>（2）将原始IP数据包封装进GRE协议, GRE协议称为封装协议(Encapsulation Protocol) ,封装的包头IP地址为虚拟直连链路两端的IP地址</p>
<p>（3）将整个GRE数据包当作数据，在外层封装公网IP包头，也就是隧道的起源和终点，从而路由到隧道终点</p>
<h1 id="实验一：配置VPN"><a href="#实验一：配置VPN" class="headerlink" title="实验一：配置VPN"></a>实验一：配置VPN</h1><h2 id="整体图："><a href="#整体图：" class="headerlink" title="整体图："></a>整体图：</h2><p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g69sppt013j30y109ajrp.jpg" alt="/img"></p>
<h2 id="基本配置："><a href="#基本配置：" class="headerlink" title="基本配置："></a>基本配置：</h2><h3 id="PC1和PC2"><a href="#PC1和PC2" class="headerlink" title="PC1和PC2:"></a>PC1和PC2:</h3><p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g69sq76y5oj30co046web.jpg" alt="/img"></p>
<h3 id="BJ"><a href="#BJ" class="headerlink" title="BJ:"></a>BJ:</h3><p>BJ(config)#int e0/0</p>
<p>BJ(config-if)#ip add 192.168.1.1 255.255.255.0</p>
<p>BJ(config-if)#no shutdown</p>
<p>BJ(config)#int e0/1</p>
<p>BJ(config-if)#ip add 61.1.1.1 255.255.255.0</p>
<p>BJ(config-if)#no shutdown</p>
<p>Internet:</p>
<p>Internet(config)#int e0/0</p>
<p>Internet(config-if)#ip add 61.1.1.2 255.255.255.0</p>
<p>Internet(config-if)#no shutdown</p>
<p>Internet(config)#int e0/1</p>
<p>Internet(config-if)#ip add 181.1.1.2 255.255.255.0</p>
<p>Internet(config-if)#no shutdown</p>
<h3 id="CD"><a href="#CD" class="headerlink" title="CD:"></a>CD:</h3><p>CD(config)#int e0/0</p>
<p>CD(config-if)#ip add 181.1.1.1 255.255.255.0</p>
<p>CD(config-if)#no shutdown</p>
<p>CD(config)#int e0/1</p>
<p>CD(config-if)#ip add 172.16.1.2 255.255.255.0</p>
<p>CD(config-if)#no shutdown</p>
<h3 id="OSPF"><a href="#OSPF" class="headerlink" title="OSPF:"></a>OSPF:</h3><p>BJ(config)#router ospf 1</p>
<p>BJ(config-router)#net</p>
<p>BJ(config-router)#network 61.1.1.0 0.0.0.255 ar</p>
<p>BJ(config-router)#network 61.1.1.0 0.0.0.255 area 0</p>
<p>Internet(config)#router ospf 1</p>
<p>Internet(config-router)#network 61.1.1.0 0.0.0.255 area 0</p>
<p>Internet(config-router)#network 181.1.1.0 0.0.0.255 area 0</p>
<p>CD(config)#router ospf 1</p>
<p>CD(config-router)#network 181.1.1.0 0.0.0.255 area 0</p>
<p>show i proute:</p>
<h3 id="各路由器"><a href="#各路由器" class="headerlink" title="各路由器"></a>各路由器</h3><p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g69sqpx15uj30eu038749.jpg" alt="/img"></p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g69sr0aekqj30d002ut8l.jpg" alt="/img"></p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g69srfu00rj30es03kweh.jpg" alt="/img"></p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g69srofqqzj3098033dfm.jpg" alt="/img"></p>
<h3 id="VPN"><a href="#VPN" class="headerlink" title="VPN:"></a>VPN:</h3><p>BJ(config)#int tunnel 1</p>
<p>BJ(config-if)#tunnel source 61.1.1.1</p>
<p>BJ(config-if)#tunnel destination 181.1.1.1</p>
<p>BJ(config-if)#ip add 10.0.0.1 255.255.255.252</p>
<p>BJ(config)#ip route 172.16.1.0 255.255.255.0 tunnel 1 //不进入接口</p>
<p>CD(config)#int tunnel 1</p>
<p>CD(config-if)#tunnel source 181.1.1.1</p>
<p>CD(config-if)#tunnel destination 61.1.1.1</p>
<p>CD(config-if)#ip address 10.0.0.2 255.255.255.252</p>
<p>CD(config)#ip route 192.168.1.0 255.255.255.0 tunnel 1</p>
<h3 id="实验成果："><a href="#实验成果：" class="headerlink" title="实验成果："></a>实验成果：</h3><p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g69sseepiqj30ce082glo.jpg" alt="/img"></p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g69ssvidc0j310o0kw75m.jpg" alt="/img"></p>
<p>最后说一下，本次实验其实很简单，代码没几行，但是过程要细致一点，比如我代码敲完了最后没Ping通，最后检查了好久，才发现是C2端的IP给错了，无话可说，但是这次是自己一个人独立操作完成的，也算是一次成长，自己写，自己检查，最后成功。</p>
<h1 id="实验二：PPTP"><a href="#实验二：PPTP" class="headerlink" title="实验二：PPTP"></a>实验二：PPTP</h1><h2 id="PPTP介绍"><a href="#PPTP介绍" class="headerlink" title="PPTP介绍"></a>PPTP介绍</h2><p>PPTP（Point to Point Tunneling Protocol）,即点对点隧道协议。该协议是在PPP协议的基础上开发的一种新的增强型安全协议，支持多协议虚拟专用网（VPN），可以通过密码验证协议（PAP）、可扩展认证协议（EAP）等方法增强安全性。可以使用远程用户通过拨入ISP、通过直接连接Internet或者其他网络安全的访问企业网</p>
<p>配置PPTP：</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g69st6vnt4j30xy0aj74n.jpg" alt="/img"></p>
<h2 id="基本配置：-1"><a href="#基本配置：-1" class="headerlink" title="基本配置："></a>基本配置：</h2><p>jiudian(config)#int e0/1</p>
<p>jiudian(config-if)#ip add 192.168.1.1 255.255.255.0</p>
<p>jiudian(config-if)#no shutdown</p>
<p>jiudian(config)#int e0/0</p>
<p>jiudian(config-if)#ip add 61.1.1.1 255.255.255.0</p>
<p>jiudian(config-if)#no shutdown</p>
<p>Internet(config)#int e0/0</p>
<p>Internet(config-if)#ip add 61.1.1.1 255.255.255.0</p>
<p>Internet(config-if)#no shutdown</p>
<p>Internet(config)#int e0/1</p>
<p>Internet(config-if)#ip add 181.1.1.1 255.255.255.0</p>
<p>Internet(config-if)#no shutdown</p>
<p>Router(config)#int e0/0</p>
<p>Router(config-if)#ip add 181.1.1.2 255.255.255.0</p>
<p>Router(config-if)#no shutdown</p>
<p>Router(config)#int e0/1</p>
<p>Router(config-if)#ip add 172.16.1.1 255.255.255.0</p>
<p>Router(config-if)#no shutdown</p>
<p>此实验可以用eigrp</p>
<p>jiudian(config)#router eigrp 10</p>
<p>jiudian(config-router)#network 192.168.1.0 0.0.0.255 //真时网络中没有这一步的</p>
<p>jiudian(config-router)#network 61.1.1.0 0.0.0.255</p>
<p>jiudian(config-router)#no auto-summary</p>
<p>Internet(config)#router eigrp 10</p>
<p>Internet(config-router)#network 61.1.1.0 0.0.0.255</p>
<p>Internet(config-router)#network 181.1.1.0 0.0.0.255</p>
<p>Internet(config-router)#no auto-summary</p>
<p>GS(config)#router eigrp 10</p>
<p>GS(config-router)#network 181.1.1.0 0.0.0.255</p>
<p>GS(config-router)#no auto-summary</p>
<h2 id="PPTP"><a href="#PPTP" class="headerlink" title="PPTP:"></a>PPTP:</h2><p>GS(config)#vpdn enable  //开启vpdn服务</p>
<p>GS(config)#vpdn-group pptp //创建一个VPDN组，命名为pptp</p>
<p>GS(config-vpdn)#accept-dialin  //允许拨号</p>
<p>GS(config-vpdn-acc-in)#protocol pptp  //协议为PPTP</p>
<p>GS(config-vpdn-acc-in)#virtual-template 1   //引用虚拟模板</p>
<p>GS(config-vpdn-acc-in)#exit</p>
<p>GS(config)#username admin password ccie  //创建拨号账号和密码</p>
<p>GS(config)#ip local pool vpn 1.1.1.100 1.1.1.110 //创建地址池</p>
<p>GS(config)#int virtual-template 1 //创建虚拟模板1</p>
<p>GS(config-if)#ppp authentication pap  //加密方式为PAP</p>
<p>GS(config-if)#peer default ip add pool vpn  //对默认IP 从地址池租约</p>
<p>GS(config-if)#ip unnumbered ethernet 0/1 //关联内网接口</p>
<p>GS(config)#ip route 0.0.0.0 0.0.0.0 e0/0 //默认路由</p>
<h2 id="虚拟机部分："><a href="#虚拟机部分：" class="headerlink" title="虚拟机部分："></a>虚拟机部分：</h2><p>实验效果：</p>
<p>此实验未做成功</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/网络/">网络</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-08-21PPP协议及验证" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2019/08/21/08-21PPP协议及验证/" class="article-date">
      <time datetime="2019-08-21T08:32:50.000Z" itemprop="datePublished">2019-08-21</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2019/08/21/08-21PPP协议及验证/">PPP协议及验证、Qos</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <h1 id="一、PPP协议及验证"><a href="#一、PPP协议及验证" class="headerlink" title="一、PPP协议及验证"></a>一、PPP协议及验证</h1>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/网络/">网络</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a   href="/2019/08/21/08-21PPP协议及验证/#more">查看更多 >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-防火墙" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2019/08/21/防火墙/" class="article-date">
      <time datetime="2019-08-20T16:00:00.000Z" itemprop="datePublished">2019-08-21</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2019/08/21/防火墙/">防火墙</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <a id="more"></a>

<h1 id="一、防火墙（Firewall）"><a href="#一、防火墙（Firewall）" class="headerlink" title="一、防火墙（Firewall）"></a>一、防火墙（Firewall）</h1><h2 id="1、什么是防火墙"><a href="#1、什么是防火墙" class="headerlink" title="1、什么是防火墙"></a>1、什么是防火墙</h2><p>防火墙是指设置在不同网络（如可信任的企业内部网和不可信的公共网）或网络安全域之间的一系列部件的组合。</p>
<p>它可通过监测、限制、更改跨越防火墙的数据流，尽可能地对外部屏蔽网络内部的信息、结构和运行状况， 以此来实现网络的安全保护。 </p>
<p>在逻辑上，防火墙是一个分离器，一个限制器，也是一个分析器，有效地监控了内部网和Internet之间的任何活动， 保证了内部网络的安全。 </p>
<h2 id="2、部署位置"><a href="#2、部署位置" class="headerlink" title="2、部署位置"></a>2、部署位置</h2><p>1、可信网络与不可信网络之间<br>2、不同安全级别网络之间<br>3、两个需要隔离的区域之间</p>
<h2 id="3、部署方式（1）"><a href="#3、部署方式（1）" class="headerlink" title="3、部署方式（1）"></a>3、部署方式（1）</h2><p>1、单防火墙（无DMZ）部署方式<br>2、单防火墙（DMZ）部署方式<br>3、双防火墙部署方式</p>
<h2 id="3、部署方式（2）"><a href="#3、部署方式（2）" class="headerlink" title="3、部署方式（2）"></a>3、部署方式（2）</h2><p>路由模式</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ave2hxubj30n109zq47.jpg" alt="/img"></p>
<p>透明模式</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6aveg0nycj30md09p3zs.jpg" alt="/img"></p>
<p>混合模式</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6avestho2j30mx0dh40h.jpg" alt="/img"></p>
<h2 id="4、功能"><a href="#4、功能" class="headerlink" title="4、功能"></a>4、功能</h2><p>1、入侵检测功能<br>2、网络地址转换功能<br>3、网络操作的审计监控功能<br>4、强化网络安全服务</p>
<h1 id="二、防火墙的配置"><a href="#二、防火墙的配置" class="headerlink" title="二、防火墙的配置"></a>二、防火墙的配置</h1><h2 id="1、路由模式防火墙配置"><a href="#1、路由模式防火墙配置" class="headerlink" title="1、路由模式防火墙配置"></a>1、路由模式防火墙配置</h2><p>形式：</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g68pfemd5pj312o0iojsm.jpg" alt="/img"></p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g68pbvjubzj30pp06r3yj.jpg" alt="/img"></p>
<p>这里可以使用虚拟机 也可以Tools&gt;VPCS 但是注意序号的差别并且点进去之后不可以点击X 不然所作的配置失效</p>
<p>虚拟机：</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g68pch3ki4j30sn0lz77r.jpg" alt="/img"></p>
<p>VPCS:</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g68pd1izjuj30cj07kdfp.jpg" alt="/img"></p>
<p>基础配置</p>
<p>R1：</p>
<p>R1(config)#int e0/0<br>R1(config-if)#ip add 192.168.1.1 255.255.255.0<br>R1(config-if)#no shutdown</p>
<p>R1(config-if)#int e0/1<br>R1(config-if)#ip add 10.0.0.2 255.255.255.252<br>R1(config-if)#no shutdown</p>
<p>R1(config)#ip route 61.1.1.0 255.255.255.0 10.0.0.1</p>
<p>R2：</p>
<p>R2(config)#int e0/0<br>R2(config-if)#ip add 61.1.1.2 255.255.255.0<br>R2(config-if)#no shutdown<br>R2(config)#ip route 192.168.1.0 255.255.255.0 61.1.1.1</p>
<p>防火墙配置：</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g68pdjcayej30a103v745.jpg" alt="/img"></p>
<p>密码可以不用管 默认密码为空值</p>
<p>PIX(config-if)# nameif outside //将e1接口设置为外接口<br>INFO: Security level for “outside” set to 0 by default.<br>PIX(config-if)# security-level 0 //安全级别设置为零 其实是默认的 这一步可以不用写<br>PIX(config-if)# ip add 61.1.1.1 255.255.255.0  //给接口一个管理IP<br>PIX(config-if)# no shu<br>PIX(config-if)# exit<br>PIX(config)# int e0<br>PIX(config-if)# nameif inside  //将e0接口设置为内接口<br>PIX(config-if)# security-level 100 //安全级别设置为内接口<br>PIX(config-if)# ip add 10.0.0.1 255.255.255.252   //给接口一个管理IP<br>PIX(config-if)# no shu<br>PIX(config-if)# exit<br>PIX(config)# route inside 192.168.1.0 255.255.255.0 10.0.0.2</p>
<p>//实现内部网络的路由，下一跳10.0.0.2，否则PIX不知道如何返回数据包<br>PIX(config)# route outside 0.0.0.0 0.0.0.0 61.1.1.2<br>PIX(config)# access-list 1 permit icmp any any<br>PIX(config)# nat (inside) 1 192.168.1.0 255.255.255.0<br> //只允许内部PC的192.168.1.0/24 网络流量<br>PIX(config)# global (outside) 1 interface  //使用地址池或者PAT</p>
<p><strong>注：pix防火墙对于内部到外部的流量默认不能做ping，做其它服务必须使用NAT功能，对到未知网络还需配置路由。而且pix防火墙可以通过由内部向外发出的返回数据包，而且默认拒绝由外部向内部发出的主动连接数据包。为了防止前次的实验干扰，在实验之前建议使用clear xlate来清除pix的内存连接</strong></p>
<p>结果：PC机能ping 同外部网络</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g68pe4xqbdj30br03zjr9.jpg" alt="/img"></p>
<p>R1能ping通外部网络</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g68pelk6wwj30g9037weg.jpg" alt="/img"></p>
<p>外部网络不能ping通内部网络</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g68pey4obwj30gv0380sp.jpg" alt="/img"></p>
<p>实验成果图：</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g68pfemd5pj312o0iojsm.jpg" alt="/img"></p>
<h2 id="2、透明式防火墙"><a href="#2、透明式防火墙" class="headerlink" title="2、透明式防火墙"></a>2、透明式防火墙</h2><p>![img](file:///C:\Users\19453\Documents\Tencent Files\1945384242\Image\Group\CRQX@G2L`DK%Q[VM~V]KVZG.png)</p>
<p>做OSPF的时候no 掉了之前写的ip route xxxx.xxxx.   但是之前写的是ip route 0.0.0.0 0.0.0.0 +下一跳接口</p>
<p>路由器R4</p>
<p>hostname R4<br>!<br>boot-start-marker<br>boot-end-marker<br>!<br>!<br>no aaa new-model<br>memory-size iomem 5<br>!<br>!<br>ip cef<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>interface Ethernet0/0<br> ip address 10.0.0.2 255.255.255.248<br> half-duplex<br>!<br>interface Ethernet0/1<br> ip address 192.168.1.2 255.255.255.0<br> half-duplex<br>!<br>interface Ethernet0/2<br> no ip address<br> shutdown<br> half-duplex<br>!<br>interface Ethernet0/3<br> no ip address<br> shutdown<br> half-duplex<br>!<br>router ospf 1<br> log-adjacency-changes<br> network 10.0.0.0 0.0.0.7 area 0<br> network 192.168.1.0 0.0.0.255 area 0<br>!<br>no ip http server<br>no ip http secure-server<br>!<br>!<br>!<br>!<br>!<br>!<br>control-plane<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>line con 0<br>line aux 0<br>line vty 0 4<br>!<br>!<br>end</p>
<p>防火墙</p>
<dl><dt>: Saved<br>:<br>PIX Version 7.2(1)<br>!<br>firewall transparent<br>hostname pixfirewall<br>enable password 8Ry2YjIyt7RRXU24 encrypted<br>names<br>!<br>interface Ethernet0<br> nameif inside<br> security-level 100<br>!<br>interface Ethernet1<br> nameif outside<br> security-level 0<br>!<br>interface Ethernet2<br> shutdown<br> no nameif<br> no security-level<br>!<br>interface Ethernet3<br> shutdown<br> no nameif<br> no security-level<br>!<br>interface Ethernet4<br> shutdown<br> no nameif<br> no security-level<br>!<br>passwd 2KFQnbNIdI.2KYOU encrypted<br>ftp mode passive<br>access-list aaa extended permit icmp any any<br>access-list 101 extended permit ospf any any<br>access-list 101 extended permit icmp any any echo<br>pager lines 24<br>mtu inside 1500<br>mtu outside 1500<br>ip address 10.0.0.3 255.255.255.248<br>no asdm history enable<br>arp timeout 14400<br>access-group 101 in interface inside<br>access-group 101 in interface outside<br>timeout xlate 3:00:00<br>timeout conn 1:00:00 half-closed 0:10:00 udp 0:02:00 icmp 0:00:02<br>timeout sunrpc 0:10:00 h323 0:05:00 h225 1:00:00 mgcp 0:05:00 mgcp-pat 0:05:00<br>timeout sip 0:30:00 sip_media 0:02:00 sip-invite 0:03:00 sip-disconnect 0:02:00<br>timeout uauth 0:05:00 absolute<br>no snmp-server location<br>no snmp-server contact<br>snmp-server enable traps snmp authentication linkup linkdown coldstart<br>telnet timeout 5<br>ssh timeout 5<br>console timeout 0<br>!<br>!<br>prompt hostname context<br>Cryptochecksum:00000000000000000000000000000000<br>: end<br>pixfirewall# conf t<br>pixfirewall(config)# acc<br>pixfirewall(config)# access-l<br>pixfirewall(config)# access-list 101 pe<br>pixfirewall(config)# access-list 101 permit ic<br>pixfirewall(config)# access-list 101 permit icmp any any<br>pixfirewall(config)# end<br>pixfirewall#<br>pixfirewall# show run<br>pixfirewall# show running-config<br>: Saved<br>:<br>PIX Version 7.2(1)<br>!<br>firewall transparent<br>hostname pixfirewall<br>enable password 8Ry2YjIyt7RRXU24 encrypted<br>names<br>!<br>interface Ethernet0<br> nameif inside<br> security-level 100<br>!<br>interface Ethernet1<br> nameif outside<br> security-level 0<br>!<br>interface Ethernet2<br> shutdown<br> no nameif<br> no security-level<br>!<br>interface Ethernet3<br> shutdown<br> no nameif<br> no security-level<br>!<br>interface Ethernet4<br> shutdown<br> no nameif<br> no security-level<br>!<br>passwd 2KFQnbNIdI.2KYOU encrypted<br>ftp mode passive<br>access-list aaa extended permit icmp any any<br>access-list 101 extended permit ospf any any<br>access-list 101 extended permit icmp any any echo<br>access-list 101 extended permit icmp any any<br>pager lines 24<br>mtu inside 1500<br>mtu outside 1500<br>ip address 10.0.0.3 255.255.255.248<br>no asdm history enable<br>arp timeout 14400<br>access-group 101 in interface inside<br>access-group 101 in interface outside<br>timeout xlate 3:00:00<br>timeout conn 1:00:00 half-closed 0:10:00 udp 0:02:00 icmp 0:00:02<br>timeout sunrpc 0:10:00 h323 0:05:00 h225 1:00:00 mgcp 0:05:00 mgcp-pat 0:05:00<br>timeout sip 0:30:00 sip_media 0:02:00 sip-invite 0:03:00 sip-disconnect 0:02:00<br>timeout uauth 0:05:00 absolute<br>no snmp-server location<br>no snmp-server contact<br>snmp-server enable traps snmp authentication linkup linkdown coldstart<br>telnet timeout 5<br>ssh timeout 5<br>console timeout 0<br>!<br>!<br>prompt hostname context<br>Cryptochecksum:00000000000000000000000000000000</dt><dd>end</dd></dl><p>路由器R6</p>
<p>Codes: C - connected, S - static, R - RIP, M - mobile, B - BGP<br>       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area<br>       N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2<br>       E1 - OSPF external type 1, E2 - OSPF external type 2<br>       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2<br>       ia - IS-IS inter area, * - candidate default, U - per-user static route<br>       o - ODR, P - periodic downloaded static route</p>
<p>Gateway of last resort is not set</p>
<pre><code>10.0.0.0/29 is subnetted, 1 subnets</code></pre><p>C       10.0.0.0 is directly connected, Ethernet0/0<br>O    192.168.1.0/24 [110/20] via 10.0.0.2, 00:01:08, Ethernet0/0<br>     61.0.0.0/24 is subnetted, 1 subnets<br>C       61.1.1.0 is directly connected, Loopback0<br>R6#show run<br>R6#show running-config<br>Building configuration…</p>
<p>Current configuration : 828 bytes<br>!<br>version 12.4<br>service timestamps debug datetime msec<br>service timestamps log datetime msec<br>no service password-encryption<br>!<br>hostname R6<br>!<br>boot-start-marker<br>boot-end-marker<br>!<br>!<br>no aaa new-model<br>memory-size iomem 5<br>!<br>!<br>ip cef<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>interface Loopback0<br> ip address 61.1.1.1 255.255.255.0<br>!<br>interface Ethernet0/0<br> ip address 10.0.0.1 255.255.255.248<br> half-duplex<br>!<br>interface Ethernet0/1<br> no ip address<br> shutdown<br> half-duplex<br>!<br>interface Ethernet0/2<br> no ip address<br> shutdown<br> half-duplex<br>!<br>interface Ethernet0/3<br> no ip address<br> shutdown<br> half-duplex<br>!<br>router ospf 1<br> log-adjacency-changes<br> network 10.0.0.0 0.0.0.7 area 0<br> network 61.1.1.0 0.0.0.255 area 0<br>!<br>no ip http server<br>no ip http secure-server<br>!<br>!<br>!<br>!<br>!<br>!<br>control-plane<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>line con 0<br>line aux 0<br>line vty 0 4<br>!<br>!<br>end</p>
<h2 id="3、混合式防火墙"><a href="#3、混合式防火墙" class="headerlink" title="3、混合式防火墙"></a>3、混合式防火墙</h2><p>作业：</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g68pkavvllj30wu0igtam.jpg" alt="/img"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/网络/">网络</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-GNS3" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2019/08/21/GNS3/" class="article-date">
      <time datetime="2019-08-20T16:00:00.000Z" itemprop="datePublished">2019-08-21</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2019/08/21/GNS3/">防火墙与VPN</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <a id="more"></a>

<h1 id="一、防火墙（Firewall）"><a href="#一、防火墙（Firewall）" class="headerlink" title="一、防火墙（Firewall）"></a>一、防火墙（Firewall）</h1><h2 id="1、什么是防火墙"><a href="#1、什么是防火墙" class="headerlink" title="1、什么是防火墙"></a>1、什么是防火墙</h2><p>防火墙是指设置在不同网络（如可信任的企业内部网和不可信的公共网）或网络安全域之间的一系列部件的组合。</p>
<p>它可通过监测、限制、更改跨越防火墙的数据流，尽可能地对外部屏蔽网络内部的信息、结构和运行状况， 以此来实现网络的安全保护。 </p>
<p>在逻辑上，防火墙是一个分离器，一个限制器，也是一个分析器，有效地监控了内部网和Internet之间的任何活动， 保证了内部网络的安全。 </p>
<h2 id="2、部署位置"><a href="#2、部署位置" class="headerlink" title="2、部署位置"></a>2、部署位置</h2><p>1、可信网络与不可信网络之间<br>2、不同安全级别网络之间<br>3、两个需要隔离的区域之间</p>
<h2 id="3、部署方式"><a href="#3、部署方式" class="headerlink" title="3、部署方式"></a>3、部署方式</h2><p>1、单防火墙（无DMZ）部署方式<br>2、单防火墙（DMZ）部署方式<br>3、双防火墙部署方式</p>
<h2 id="4、功能"><a href="#4、功能" class="headerlink" title="4、功能"></a>4、功能</h2><p>1、入侵检测功能<br>2、网络地址转换功能<br>3、网络操作的审计监控功能<br>4、强化网络安全服务</p>
<h1 id="二、VPN"><a href="#二、VPN" class="headerlink" title="二、VPN"></a>二、VPN</h1><h2 id="1、L2TP-VPN"><a href="#1、L2TP-VPN" class="headerlink" title="1、L2TP VPN"></a>1、L2TP VPN</h2><p>2TP是一种工业标准的Internet隧道协议，功能大致和PPTP协议类似，比如同样可以对网络数据流进行加密。不过也有不同之处，比如PPTP要求网络为IP网络，L2TP要求面向数据包的点对点连接；PPTP使用单一隧道，L2TP使用多隧道；L2TP提供包头压缩、隧道验证，而PPTP不支持。</p>
<h2 id="2、PPTP-VPN"><a href="#2、PPTP-VPN" class="headerlink" title="2、PPTP-VPN"></a>2、PPTP-VPN</h2><p>即点对点隧道协议。该协议是在PPP协议的基础上开发的一种新的增强型安全协议，支持多协议虚拟专用网（VPN），可以通过密码验证协议（PAP）、可扩展认证协议（EAP）等方法增强安全性。可以使远程用户通过拨入ISP、通过直接连接Internet或其他网络安全地访问企业网。</p>
<h2 id="3、IPsec-VPN"><a href="#3、IPsec-VPN" class="headerlink" title="3、IPsec-VPN"></a>3、IPsec-VPN</h2><p>互联网安全协议（英语：Internet Protocol Security，缩写为IPsec），是一个协议包，通过对IP协议的分组进行加密和认证来保护IP协议的网络传输协议族（一些相互关联的协议的集合）。 [1]<br>IPsec主要由以下协议组成：</p>
<p>一、认证头（AH），为IP数据报提供无连接数据完整性、消息认证以及防重放攻击保护；</p>
<p>二、封装安全载荷（ESP），提供机密性、数据源认证、无连接完整性、防重放和有限的传输流（traffic-flow）机密性；</p>
<p>三、安全关联（SA），提供算法和数据包，提供AH、ESP操作所需的参数。</p>
<p>IPsec协议工作在OSI模型的第三层，使其在单独使用时适于保护基于TCP或UDP的协议（如安全套接子层（SSL）就不能保护UDP层的通信流）。这就意味着，与传输层或更高层的协议相比，IPsec协议必须处理可靠性和分片的问题，这同时也增加了它的复杂性和处理开销。相对而言，SSL/TLS依靠更高层的TCP（OSI的第四层）来管理可靠性和分片。</p>
<h2 id="4、GRE-VPN"><a href="#4、GRE-VPN" class="headerlink" title="4、GRE VPN"></a>4、GRE VPN</h2><p>GRE是一种最传统的隧道协议，其根本功能就是要实现隧道功能，通过隧道连接的两<br>个远程网络就如同直连，GRE在两个远程网络之间模拟出直连链路,从而使网络间达到直<br>连的效果，为此，GRE需要完成多次封装,总共有3次</p>
<p>（1）接收原始IP数据包当作乘客协议,原始IR数据包包头的IP地址为私有IP地址</p>
<p>（2）将原始IP数据包封装进GRE协议, GRE协议称为封装协议(Encapsulation Protocol) ,封装的包头IP地址为虚拟直连链路两端的IP地址</p>
<p>（3）将整个GRE数据包当作数据，在外层封装公网IP包头，也就是隧道的起源和终点，从而路由到隧道终点</p>
<h1 id="三、防火墙的配置"><a href="#三、防火墙的配置" class="headerlink" title="三、防火墙的配置"></a>三、防火墙的配置</h1><h2 id="1、路由模式防火墙配置"><a href="#1、路由模式防火墙配置" class="headerlink" title="1、路由模式防火墙配置"></a>1、路由模式防火墙配置</h2><p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g68pfemd5pj312o0iojsm.jpg" alt="/img"></p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g68pbvjubzj30pp06r3yj.jpg" alt="/img"></p>
<p>这里可以使用虚拟机 也可以Tools&gt;VPCS 但是注意序号的差别并且点进去之后不可以点击X 不然所作的配置失效</p>
<p>虚拟机：</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g68pch3ki4j30sn0lz77r.jpg" alt="/img"></p>
<p>VPCS:</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g68pd1izjuj30cj07kdfp.jpg" alt="/img"></p>
<p>基础配置</p>
<p>R1：</p>
<p>R1(config)#int e0/0<br>R1(config-if)#ip add 192.168.1.1 255.255.255.0<br>R1(config-if)#no shutdown</p>
<p>R1(config-if)#int e0/1<br>R1(config-if)#ip add 10.0.0.2 255.255.255.252<br>R1(config-if)#no shutdown</p>
<p>R1(config)#ip route 61.1.1.0 255.255.255.0 10.0.0.1</p>
<p>R2：</p>
<p>R2(config)#int e0/0<br>R2(config-if)#ip add 61.1.1.2 255.255.255.0<br>R2(config-if)#no shutdown<br>R2(config)#ip route 192.168.1.0 255.255.255.0 61.1.1.1</p>
<p>防火墙配置：</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g68pdjcayej30a103v745.jpg" alt="/img"></p>
<p>密码可以不用管 默认密码为空值</p>
<p>PIX(config-if)# nameif outside //将e1接口设置为外接口<br>INFO: Security level for “outside” set to 0 by default.<br>PIX(config-if)# security-level 0 //安全级别设置为零 其实是默认的 这一步可以不用写<br>PIX(config-if)# ip add 61.1.1.1 255.255.255.0  //给接口一个管理IP<br>PIX(config-if)# no shu<br>PIX(config-if)# exit<br>PIX(config)# int e0<br>PIX(config-if)# nameif inside  //将e0接口设置为内接口<br>PIX(config-if)# security-level 100 //安全级别设置为内接口<br>PIX(config-if)# ip add 10.0.0.1 255.255.255.252   //给接口一个管理IP<br>PIX(config-if)# no shu<br>PIX(config-if)# exit<br>PIX(config)# route inside 192.168.1.0 255.255.255.0 10.0.0.2</p>
<p>//实现内部网络的路由，下一跳10.0.0.2，否则PIX不知道如何返回数据包<br>PIX(config)# route outside 0.0.0.0 0.0.0.0 61.1.1.2<br>PIX(config)# access-list 1 permit icmp any any<br>PIX(config)# nat (inside) 1 192.168.1.0 255.255.255.0<br> //只允许内部PC的192.168.1.0/24 网络流量<br>PIX(config)# global (outside) 1 interface  //使用地址池或者PAT</p>
<p><strong>注：pix防火墙对于内部到外部的流量默认不能做ping，做其它服务必须使用NAT功能，对到未知网络还需配置路由。而且pix防火墙可以通过由内部向外发出的返回数据包，而且默认拒绝由外部向内部发出的主动连接数据包。为了防止前次的实验干扰，在实验之前建议使用clear xlate来清除pix的内存连接</strong></p>
<p>结果：PC机能ping 同外部网络</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g68pe4xqbdj30br03zjr9.jpg" alt="/img"></p>
<p>R1能ping通外部网络</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g68pelk6wwj30g9037weg.jpg" alt="/img"></p>
<p>外部网络不能ping通内部网络</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g68pey4obwj30gv0380sp.jpg" alt="/img"></p>
<p>实验成果图：</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g68pfemd5pj312o0iojsm.jpg" alt="/img"></p>
<h2 id="2、透明式防火墙"><a href="#2、透明式防火墙" class="headerlink" title="2、透明式防火墙"></a>2、透明式防火墙</h2><p>![img](file:///C:\Users\19453\Documents\Tencent Files\1945384242\Image\Group\CRQX@G2L`DK%Q[VM~V]KVZG.png)</p>
<p>做OSPF的时候no 掉了之前写的ip route xxxx.xxxx.   但是之前写的是ip route 0.0.0.0 0.0.0.0 +下一跳接口</p>
<p>路由器R4</p>
<p>hostname R4<br>!<br>boot-start-marker<br>boot-end-marker<br>!<br>!<br>no aaa new-model<br>memory-size iomem 5<br>!<br>!<br>ip cef<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>interface Ethernet0/0<br> ip address 10.0.0.2 255.255.255.248<br> half-duplex<br>!<br>interface Ethernet0/1<br> ip address 192.168.1.2 255.255.255.0<br> half-duplex<br>!<br>interface Ethernet0/2<br> no ip address<br> shutdown<br> half-duplex<br>!<br>interface Ethernet0/3<br> no ip address<br> shutdown<br> half-duplex<br>!<br>router ospf 1<br> log-adjacency-changes<br> network 10.0.0.0 0.0.0.7 area 0<br> network 192.168.1.0 0.0.0.255 area 0<br>!<br>no ip http server<br>no ip http secure-server<br>!<br>!<br>!<br>!<br>!<br>!<br>control-plane<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>line con 0<br>line aux 0<br>line vty 0 4<br>!<br>!<br>end</p>
<p>防火墙</p>
<dl><dt>: Saved<br>:<br>PIX Version 7.2(1)<br>!<br>firewall transparent<br>hostname pixfirewall<br>enable password 8Ry2YjIyt7RRXU24 encrypted<br>names<br>!<br>interface Ethernet0<br> nameif inside<br> security-level 100<br>!<br>interface Ethernet1<br> nameif outside<br> security-level 0<br>!<br>interface Ethernet2<br> shutdown<br> no nameif<br> no security-level<br>!<br>interface Ethernet3<br> shutdown<br> no nameif<br> no security-level<br>!<br>interface Ethernet4<br> shutdown<br> no nameif<br> no security-level<br>!<br>passwd 2KFQnbNIdI.2KYOU encrypted<br>ftp mode passive<br>access-list aaa extended permit icmp any any<br>access-list 101 extended permit ospf any any<br>access-list 101 extended permit icmp any any echo<br>pager lines 24<br>mtu inside 1500<br>mtu outside 1500<br>ip address 10.0.0.3 255.255.255.248<br>no asdm history enable<br>arp timeout 14400<br>access-group 101 in interface inside<br>access-group 101 in interface outside<br>timeout xlate 3:00:00<br>timeout conn 1:00:00 half-closed 0:10:00 udp 0:02:00 icmp 0:00:02<br>timeout sunrpc 0:10:00 h323 0:05:00 h225 1:00:00 mgcp 0:05:00 mgcp-pat 0:05:00<br>timeout sip 0:30:00 sip_media 0:02:00 sip-invite 0:03:00 sip-disconnect 0:02:00<br>timeout uauth 0:05:00 absolute<br>no snmp-server location<br>no snmp-server contact<br>snmp-server enable traps snmp authentication linkup linkdown coldstart<br>telnet timeout 5<br>ssh timeout 5<br>console timeout 0<br>!<br>!<br>prompt hostname context<br>Cryptochecksum:00000000000000000000000000000000<br>: end<br>pixfirewall# conf t<br>pixfirewall(config)# acc<br>pixfirewall(config)# access-l<br>pixfirewall(config)# access-list 101 pe<br>pixfirewall(config)# access-list 101 permit ic<br>pixfirewall(config)# access-list 101 permit icmp any any<br>pixfirewall(config)# end<br>pixfirewall#<br>pixfirewall# show run<br>pixfirewall# show running-config<br>: Saved<br>:<br>PIX Version 7.2(1)<br>!<br>firewall transparent<br>hostname pixfirewall<br>enable password 8Ry2YjIyt7RRXU24 encrypted<br>names<br>!<br>interface Ethernet0<br> nameif inside<br> security-level 100<br>!<br>interface Ethernet1<br> nameif outside<br> security-level 0<br>!<br>interface Ethernet2<br> shutdown<br> no nameif<br> no security-level<br>!<br>interface Ethernet3<br> shutdown<br> no nameif<br> no security-level<br>!<br>interface Ethernet4<br> shutdown<br> no nameif<br> no security-level<br>!<br>passwd 2KFQnbNIdI.2KYOU encrypted<br>ftp mode passive<br>access-list aaa extended permit icmp any any<br>access-list 101 extended permit ospf any any<br>access-list 101 extended permit icmp any any echo<br>access-list 101 extended permit icmp any any<br>pager lines 24<br>mtu inside 1500<br>mtu outside 1500<br>ip address 10.0.0.3 255.255.255.248<br>no asdm history enable<br>arp timeout 14400<br>access-group 101 in interface inside<br>access-group 101 in interface outside<br>timeout xlate 3:00:00<br>timeout conn 1:00:00 half-closed 0:10:00 udp 0:02:00 icmp 0:00:02<br>timeout sunrpc 0:10:00 h323 0:05:00 h225 1:00:00 mgcp 0:05:00 mgcp-pat 0:05:00<br>timeout sip 0:30:00 sip_media 0:02:00 sip-invite 0:03:00 sip-disconnect 0:02:00<br>timeout uauth 0:05:00 absolute<br>no snmp-server location<br>no snmp-server contact<br>snmp-server enable traps snmp authentication linkup linkdown coldstart<br>telnet timeout 5<br>ssh timeout 5<br>console timeout 0<br>!<br>!<br>prompt hostname context<br>Cryptochecksum:00000000000000000000000000000000</dt><dd>end</dd></dl><p>路由器R6</p>
<p>Codes: C - connected, S - static, R - RIP, M - mobile, B - BGP<br>       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area<br>       N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2<br>       E1 - OSPF external type 1, E2 - OSPF external type 2<br>       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2<br>       ia - IS-IS inter area, * - candidate default, U - per-user static route<br>       o - ODR, P - periodic downloaded static route</p>
<p>Gateway of last resort is not set</p>
<pre><code>10.0.0.0/29 is subnetted, 1 subnets</code></pre><p>C       10.0.0.0 is directly connected, Ethernet0/0<br>O    192.168.1.0/24 [110/20] via 10.0.0.2, 00:01:08, Ethernet0/0<br>     61.0.0.0/24 is subnetted, 1 subnets<br>C       61.1.1.0 is directly connected, Loopback0<br>R6#show run<br>R6#show running-config<br>Building configuration…</p>
<p>Current configuration : 828 bytes<br>!<br>version 12.4<br>service timestamps debug datetime msec<br>service timestamps log datetime msec<br>no service password-encryption<br>!<br>hostname R6<br>!<br>boot-start-marker<br>boot-end-marker<br>!<br>!<br>no aaa new-model<br>memory-size iomem 5<br>!<br>!<br>ip cef<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>interface Loopback0<br> ip address 61.1.1.1 255.255.255.0<br>!<br>interface Ethernet0/0<br> ip address 10.0.0.1 255.255.255.248<br> half-duplex<br>!<br>interface Ethernet0/1<br> no ip address<br> shutdown<br> half-duplex<br>!<br>interface Ethernet0/2<br> no ip address<br> shutdown<br> half-duplex<br>!<br>interface Ethernet0/3<br> no ip address<br> shutdown<br> half-duplex<br>!<br>router ospf 1<br> log-adjacency-changes<br> network 10.0.0.0 0.0.0.7 area 0<br> network 61.1.1.0 0.0.0.255 area 0<br>!<br>no ip http server<br>no ip http secure-server<br>!<br>!<br>!<br>!<br>!<br>!<br>control-plane<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>!<br>line con 0<br>line aux 0<br>line vty 0 4<br>!<br>!<br>end</p>
<h2 id="3、混合式防火墙"><a href="#3、混合式防火墙" class="headerlink" title="3、混合式防火墙"></a>3、混合式防火墙</h2><p>作业：</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g68pkavvllj30wu0igtam.jpg" alt="/img"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/网络/">网络</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-网络地址转换NAT" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2019/08/20/网络地址转换NAT/" class="article-date">
      <time datetime="2019-08-19T16:00:00.000Z" itemprop="datePublished">2019-08-20</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2019/08/20/网络地址转换NAT/">网络地址转换NAT</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <a id="more"></a>

<h2 id="网络地址转换（NAT）"><a href="#网络地址转换（NAT）" class="headerlink" title="网络地址转换（NAT）"></a>网络地址转换（NAT）</h2><h4 id="什么是NAT"><a href="#什么是NAT" class="headerlink" title="什么是NAT"></a>什么是NAT</h4><p>一种将私有（保留）地址转化为合法IP地址的转换技术，它被广泛应用于各种类型Internet接入方式和各种类型的网络中。</p>
<p>NAT技术设计初衷</p>
<p>增加私有组织的可用地址空间</p>
<p>解决现有私有网络接入的IP地址编号问题</p>
<h4 id="NAT的优缺点"><a href="#NAT的优缺点" class="headerlink" title="NAT的优缺点"></a>NAT的优缺点</h4><p>优点</p>
<p>管理方便并且节约IP地址资源</p>
<p>隐藏内部 IP 地址信息</p>
<p>可用于实现网络负载均衡</p>
<p>缺点</p>
<p>外部应用程序却不能方便地与 NAT 网关后面的应用程序联系。 </p>
<h4 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h4><p>  通过使用少量公有IP表示众多私有IP地址实现的，为推迟可用IP地址空间耗尽的时间</p>
<p><img src="http://ww1.sinaimg.cn/large/0072FDFVgy1g63yf40hjzj30lg09vgov.jpg" alt="/img"></p>
<p><strong>NAT适用于以下情况</strong>：</p>
<p>1 需要连接到INTERNET，但主机没有全局唯一的IP地址；</p>
<p>2 更换的ISP（Internet Service Provider，网络最终用户进入internet的入口和桥梁）要求对网络进行重新编址；</p>
<p>3 需要合并两个使用相同编址方案的内联网；</p>
<p>且NAT通常用于边界路由器；</p>
<h3 id="NAT的优缺点-1"><a href="#NAT的优缺点-1" class="headerlink" title="NAT的优缺点"></a>NAT的优缺点</h3><p><img src="http://ww1.sinaimg.cn/large/0072FDFVgy1g63ymuy7jmj30nq064dif.jpg" alt="/img"></p>
<p>最明显的优点：能够节省合法的注册地址，这也是IPv4地址至今未耗尽的原因；将局域网隐藏在公用网络之中，增加网络的安全性；</p>
<h3 id="网络地址转换类型"><a href="#网络地址转换类型" class="headerlink" title="网络地址转换类型"></a>网络地址转换类型</h3><h4 id="静态NAT"><a href="#静态NAT" class="headerlink" title="静态NAT"></a>静态NAT</h4><p>这种NAT能够在本地地址和全局地址之间进行一对一映射。即使用静态NAT时，必须为网络中的每台主机提供一个公有因特网IP地址。</p>
<p><img src="http://ww1.sinaimg.cn/large/0072FDFVgy1g685q62wu8j30jw0e8dhh.jpg" alt="/img"></p>
<h4 id="动态NAT"><a href="#动态NAT" class="headerlink" title="动态NAT"></a>动态NAT</h4><p>它能够将未注册的IP地址映射到注册IP地址池中的一个地址，无需配置静态路由器，使其将每个内部地址映射到一个外部地址，但必须有足够的公有因特网IP地址，让连接到因特网的主机都能够同时发送和接收分组。</p>
<h4 id="NAT重载"><a href="#NAT重载" class="headerlink" title="NAT重载"></a>NAT重载</h4><p>也是动态NAT，它利用源端口将多个非注册的IP地址映射到一个注册IP地址，形成多对一。也被称为端口地址转换（PAT）。通过使用 PAT (NAT 重载)，只 使用一个全局 地址，就可将数千名用户连接到因特网，这是不是很酷?因特网 IP 地址之所以还未耗尽，真正的原因就在 使用了 NAT重载。</p>
<h4 id="NAT术语"><a href="#NAT术语" class="headerlink" title="NAT术语"></a>NAT术语</h4><p><img src="http://ww1.sinaimg.cn/large/0072FDFVgy1g63yx0ca48j30l205amyl.jpg" alt="/img"></p>
<p>对于用于 NAT 的地址，我们使用的术语很简单。 NAT 转换后的地址称为全局地址，这通常是因特网公有地址;但如果无需连接到因特网，则不需要公有地址。</p>
<p>进行 NAT 转换前的地址称为本地地址。因此，内部本地地址是试图连接到因特网的主机的私有地址;而外部本地地址通常是与 ISP 相连的路由器接口的地址。后者通常是公有地址，主机发送的分组的源地址通常会转换为这种地址。</p>
<p>内部本地地址将被转换为内部全局地址，而外部全局地址将成为目标地址。表 13-2 列出了各种 NAT术语。</p>
<h3 id="静态NAT配置"><a href="#静态NAT配置" class="headerlink" title="静态NAT配置"></a>静态NAT配置</h3><p>示例图：<img src="http://ww1.sinaimg.cn/large/0072FDFVgy1g673plhco0j30mq0bbdgy.jpg" alt="/img"></p>
<p>实际拓扑图：</p>
<p><img src="http://ww1.sinaimg.cn/large/0072FDFVgy1g674wcg0htj30od0dhaag.jpg" alt="/img"></p>
<p>静态NAT：</p>
<p>基本配置：</p>
<p>加模块：</p>
<p><img src="C:%5CUsers%5C19453%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1566558306805.png" alt="1566558306805"></p>
<p>交换机配置：</p>
<p>SW:</p>
<p>SW1(config)#vlan 10</p>
<p>SW1(config-vlan)#int vlan 10</p>
<p>SW1(config-if)#exit</p>
<p>SW1(config)#vlan 20</p>
<p>SW1(config-vlan)#int vlan 20</p>
<p>SW1(config-if)#exit</p>
<p>把端口接入vlan </p>
<p>SW1(config)#int f0/1</p>
<p>SW1(config-if)#sw mo acc</p>
<p>SW1(config-if)#sw acc vlan 10</p>
<p>SW1(config-if)#no shutdown </p>
<p>SW1(config-if)#exit</p>
<p>SW1(config)#int f0/2</p>
<p>SW1(config-if)#sw mo acc</p>
<p>SW1(config-if)#sw acc vlan 20</p>
<p>SW1(config-if)#no shutdown </p>
<p>SW1(config)#int f0/3</p>
<p>SW1(config-if)#sw mo trunk </p>
<p>SW1(config-if)#no shutdown </p>
<p>路由器配置:</p>
<p>R1(config)#int f0/0.10</p>
<p>R1(config-subif)#encapsulation dot1Q 10</p>
<p>R1(config-subif)#ip add 192.168.0.254 255.255.255.0</p>
<p>R1(config-subif)#no shutdown </p>
<p>R1(config)#int f0/0.20</p>
<p>R1(config-subif)#encapsulation dot1Q 20</p>
<p>R1(config-subif)#ip add 192.168.1.254 255.255.255.0</p>
<p>R1(config-subif)#no shutdown </p>
<p>R1(config)#int f0/0</p>
<p>R1(config-if)#no shutdown </p>
<p>R1(config)#int s0/3/0</p>
<p>R1(config-if)#ip add 61.1.1.1 255.255.255.0</p>
<p>R1(config-if)#no shutdown </p>
<p>R2(config)#int s0/3/0</p>
<p>R2(config-if)#ip add 61.1.1.2 255.255.255.0 </p>
<p>R2(config-if)#no shutdown </p>
<p> R2(config)#int f0/0</p>
<p>R2(config-if)#ip add 172.16.1.254 255.255.255.0</p>
<p>R2(config-if)#no shutdown </p>
<p>R1(config)#int f0/0.10<br>R1(config-subif)#ip nat inside<br>R1(config)#int f0/0.20<br>R1(config-subif)#ip nat inside </p>
<p>R1(config)#ip route 172.16.1.0 255.255.255.0 61.1.1.2 //我在配置的时候就少了这句，然后找了好久好久才发现漏掉了这个，少了这句话服务器就找不到经过R2的下一跳路由，就ping不到PC2</p>
<p>效果展示：</p>
<p><img src="C:%5CUsers%5C19453%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1566565998981.png" alt="1566565998981"></p>
<p><img src="C:%5CUsers%5C19453%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1566566018310.png" alt="1566566018310"></p>
<p>R1#debug ip nat</p>
<p>R1#show ip nat translations </p>
<p><img src="C:%5CUsers%5C19453%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1566566113573.png" alt="1566566113573"></p>
<p>最终实现效果：服务器可以访问外部网络的PC机，而外部网络不可以访问内部服务器，如果要内部网络可以访问外部网络，就加上一条静态的：ip nat inside source static 192.168.1.1  61.1.1.1 </p>
<p>动态NAT：</p>
<p>为了方便，动态nat是在静态的基础上做的，把之前写的ip nat inside source static 192.168.0.1 61.1.1.1 删掉就可以了</p>
<p>核心配置：</p>
<p><img src="C:%5CUsers%5C19453%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1566567476212.png" alt="1566567476212"></p>
<p><img src="C:%5CUsers%5C19453%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1566567687190.png" alt="1566567687190"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/网络/">网络</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-IPv4编址方案" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="/2019/08/05/IPv4编址方案/" class="article-date">
      <time datetime="2019-08-04T16:00:00.000Z" itemprop="datePublished">2019-08-05</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="/2019/08/05/IPv4编址方案/">IP地址介绍、VLSM、初识思科</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>第二讲 IP地址介绍及VLSM**</p>
<h2 id="一、-IPv4-编址方案"><a href="#一、-IPv4-编址方案" class="headerlink" title="一、**IPv4**编址方案"></a><strong>一、**</strong>IPv4<strong>**编址方案</strong></h2><p>IP地址由32位二进制数组成，这些位被划分为4组，中间用“.”号隔开，每组8位，以十进制数形式表示。分为<strong>网络地址</strong>和<strong>主机地址</strong>两个部分。</p>
<h3 id="1、-IP-地址分类"><a href="#1、-IP-地址分类" class="headerlink" title="1、**IP**地址分类"></a><strong>1、**</strong>IP<strong>**地址分类</strong></h3><h4 id="A-类网络地址范围"><a href="#A-类网络地址范围" class="headerlink" title="A**类网络地址范围**"></a><strong>A**</strong>类网络地址范围**</h4><p>​    第一个字节的第一位必须为0，第一个字节的取值为<strong>0**</strong>－127**</p>
<p>​        即：0xxxxxxx    取值范围是：<strong>0</strong>0000000－<strong>0</strong>1111111  （0－127）</p>
<p><strong>1.1.1.1/8</strong>   <strong>网络号：8**</strong>位   255.0.0.0**</p>
<p>网络地址：1.0.0.0</p>
<p>广播地址：1.255.255.255</p>
<p>在这网络中有多少个地址呢？2^24</p>
<p>有效地址：2^24-2</p>
<h4 id="B-类网络地址范围"><a href="#B-类网络地址范围" class="headerlink" title="B**类网络地址范围**"></a><strong>B**</strong>类网络地址范围**</h4><p>第一个字节的第一位必须是1，且第二位必须是0，第一个字节的取值为<strong>128**</strong>－191**</p>
<p>​       即：<strong>1</strong>0000000   取值范围是：<strong>10</strong>000000－<strong>10</strong>111111   （128－191）</p>
<p>181.1.1.1/16   255.255.0.0</p>
<p>网络地址：181.1.0.0</p>
<p>广播地址：181.1.255.255</p>
<p>有效地址：2^16-2</p>
<h4 id="C-类网络的地址范围"><a href="#C-类网络的地址范围" class="headerlink" title="C**类网络的地址范围**"></a><strong>C**</strong>类网络的地址范围**</h4><p>​    第一个字节的前两位必须是1，且第三位必须是0，第一个字节的取值为<strong>192**</strong>－223**</p>
<p>​       即：<strong>110</strong>00000   取值范围是：<strong>110</strong>00000－11011111   （192－223）</p>
<p>192.168.1.1/24  255.255.255.0</p>
<p>网络地址：192.168.1.0</p>
<p>广播地址：192.168.1.255</p>
<p>有效地址：2^8-2  254</p>
<p><strong>D**</strong>类网络的地址范围：第一个字节为224–239<strong>**，用作组播地址。</strong></p>
<p><strong>E**</strong>类网络的地址范围：第一个字节为240–255<strong>**，用于科学用途。</strong></p>
<h3 id="2-、保留的IP地址"><a href="#2-、保留的IP地址" class="headerlink" title="2**、保留的IP地址**"></a><strong>2**</strong>、保留的<strong><strong>IP</strong></strong>地址**</h3><p>   <img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ascnwblgj30fj003064.jpg" alt="/img">   <strong>地</strong>  <strong>址</strong>                     <strong>功</strong>     <strong>能</strong></p>
<p>网络地址全为0           表示当前网络或网段</p>
<p>网络地址全为1           表示所有网络</p>
<p>地址127.0.0.1            保留用于环回测试</p>
<p>节点地址全为0           表示网络地址或指定网络中的任何主机</p>
<p>节点地址全为1           表示指定网络中的所有节点</p>
<p>整个IP地址全为0         思科路由器用它来指定默认路由，也可能表示任何网络</p>
<p>整个IP地址全为1         到当前网络中所有节点的广播，有时称为“全1广播”或限定</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ascnwblgj30fj003064.jpg" alt="/img">                         广播即：255.255.255.255</p>
<h3 id="3-、各类网络地址中网络数和主机数"><a href="#3-、各类网络地址中网络数和主机数" class="headerlink" title="3**、各类网络地址中网络数和主机数**"></a><strong>3**</strong>、各类网络地址中网络数和主机数**</h3><p>　　A 类网络地址：</p>
<p>　　　　　　实际可用的A类网络地址数为：2^7=128</p>
<p>​                         合法的主机数为：2 ^24－2＝16777214</p>
<p>　　B类网络地址：</p>
<p>　　　　　　实际可用的B类网络地址数为：2^14=16384</p>
<p>​                        合法的主机数为：2^16-2=65534</p>
<p>　　C类网络地址：</p>
<p>　　　　　　实际可用的C类网络地址数为：2^21=2097152</p>
<p>​                        合法的主机数为：2^8-2=254</p>
<h3 id="4-、私有IP地址范围-在公网中是不能路由的，必须经过地址转换。"><a href="#4-、私有IP地址范围-在公网中是不能路由的，必须经过地址转换。" class="headerlink" title="4**、私有IP地址范围** 在公网中是不能路由的，必须经过地址转换。"></a><strong>4**</strong>、私有<strong><strong>IP</strong></strong>地址范围** <strong>在公网中是不能路由的，必须经过地址转换。</strong></h3><p>　　　A类　　　10.0.0.0~10.255.255.255</p>
<p>​      B类      172.16.0.0~172.31.255.255</p>
<p>​      C类      192.168.0.0~192.168.255.255</p>
<p><strong>子网划分：将大的网络划分成若干个小网络，尽量减少广播风暴，提高网络效率。</strong></p>
<p>C类IP地址： <strong>192.168.1</strong>.0 /24  255.255.255.0  有效地址：254个</p>
<p><strong>请问**</strong>192.168.1.201/27<strong>**在哪个网络？网络号是多少？广播号是多少？有效地址范围是多少？</strong></p>
<p>B类IP地址：181.1.0.0/17   255.255.128.0</p>
<p>181.1.0.0</p>
<p>181.1.0.1  -  181.1.127.254</p>
<p>181.1.128.0</p>
<h3 id="5-、如何创建子网？"><a href="#5-、如何创建子网？" class="headerlink" title="5**、如何创建子网？**"></a><strong>5**</strong>、如何创建子网？**</h3><p>   要创建子网，我们可以采用如下步骤：</p>
<p>​     （1）确定需要的网络ID数</p>
<p>​           ■ 每个LAN子网一个</p>
<p>​           ■ 每条广域网连接一个        </p>
<p>​     （2）确定每个子网所需的主机ID数</p>
<p>​           ■每个TCP/IP主机一个</p>
<p>​           ■每个路由器接口一个</p>
<p>​    （3）根据上述需要，确定如下内容：</p>
<p>​           ■一个用于整个网络的子网掩码</p>
<p>​           ■每个物理网段的唯一子网ID</p>
<p>​           ■每个子网的主机ID范围</p>
<p><strong>5、**</strong>C<strong>**类网络的子网划分</strong></p>
<p><strong>C**</strong>类网络的快速子网划分**</p>
<p>给网络选择子网掩码后，需要计算该子网掩码提供的子网数以及每个子网的合法主机地址和广播地址。为此，你只需要回答下面5个问题：</p>
<p><strong>（1）**</strong>选定的子网掩码将创建多少个子网？**</p>
<p>​         <strong>192.168.1.0 /26</strong></p>
<p><strong>11111111.11111111.11111111.11000000</strong></p>
<p>​                          <strong>128+64=192</strong></p>
<p>​       <strong>子网掩码值：255.255.255.192</strong></p>
<p>​     2^2个，向主机位借位（取值为1）的位数。例：11000000，子网数为：2^2（4个）</p>
<p><strong>（2**</strong>）每个子网可包含多少台主机？**</p>
<p>​     2y个，y为被遮盖（取值为0）的位数。例：11000000，每个子网包含的主机数</p>
<p>​     为：2^6－2（62个）</p>
<p><strong>（3**</strong>）有哪些合法的子网？**</p>
<p>​     块大小（增量）为<strong>256**</strong>－子网掩码**。如：256－192＝64，即子网掩码为192时，</p>
<p> 块大小为64。从0开始不断增加64，直到达到子网掩码值，中间的值就是子网，即：</p>
<p>192.168.1.0–63</p>
<p>网络号：192.168.1.0</p>
<p>广播号：192.168.1.63</p>
<p>有效地址范围：192.168.1.1–192.168.1.62</p>
<p>192.168.1.64-127</p>
<p>网络号：192.168.1.64</p>
<p>广播号：192.168.1.127</p>
<p>有效地址范围：192.168.1.65-192.168.126</p>
<p>192.168.128-191</p>
<p>192.168.128</p>
<p>192.168.1.192-255</p>
<p>192.168.4.0  255.255.255.0  划分8个子网</p>
<p><strong>11111111.11111111.11111111.11100000</strong></p>
<p>​                          <strong>128+64+32=224</strong></p>
<p>192.168.4.0/27   255.255.255.224</p>
<p>2^3=8</p>
<p>块大小：256-224=32</p>
<p>地址范围：</p>
<p>192.168.4.0–192.168.4.31</p>
<p>网络号：</p>
<p>广播号：</p>
<p>有效地址：</p>
<p>4.0–31</p>
<p>192.168.4.32–192.168.4.63</p>
<p>192.168.4.64–192.168.4.95</p>
<p>96–127</p>
<p>128–159</p>
<p>160–191</p>
<p>192–223</p>
<p>224–255</p>
<p>192.168.4.200请问这个地址是属于哪个网络</p>
<p><strong>练习：</strong></p>
<p><strong>例1</strong>：255.255.255.128 （/25）</p>
<p>​       网络地址：192.168.10.0</p>
<p>​       子网掩码：255.255.255.128</p>
<p><strong>例2</strong>：255.255.255.224（/27）</p>
<p>  网络地址：192.168.10.0</p>
<p>  子网掩码：255.255.255.224</p>
<p><strong>多少个子网？</strong></p>
<p><strong>每个子网多少台主机？</strong></p>
<p><strong>有哪些合法的子网？</strong></p>
<p><strong>每个子网的广播地址是多少？</strong></p>
<p><strong>每个子网包含哪些合法主机地址？</strong></p>
<p><strong>3、**</strong>网络地址：192.168.10.33** <strong>，子网掩码：255.255.255.224**</strong>，有哪些网络？分别有哪些**</p>
<p><strong>4**</strong>、假设主机地址为：192.168.10.174<strong><strong>，子网掩码为255.255.255.240</strong></strong>。合法的主**</p>
<p>   <strong>机地址范围是多少呢？</strong></p>
<p> <strong>5**</strong>、如果节点地址为：192.168.10.17<strong><strong>，子网掩码为：255.255.255.252</strong></strong>。该IP<strong>**地址属于哪个子网？该子网的广播地址是什么？</strong></p>
<p><strong>B**</strong>类地址的子网划分**</p>
<p><strong>举例１：172.16.0.0/16       255.255.0.0</strong></p>
<p>​                          <strong>11111111.11111111.10000000.00000000</strong></p>
<p><strong>划分为两个网络：2^1=2</strong></p>
<p>　　　<strong>子网掩码是多少？255.255.128.0</strong></p>
<p><strong>块大小是多少？256-128=128</strong></p>
<p>　　　<strong>有哪些合法的子网？</strong></p>
<p>​         <strong>172.16.0.0</strong></p>
<p>​         <strong>172.16.128.0</strong></p>
<p>　<strong>每个子网多少台主机？2^15-2=32766</strong></p>
<p>　　　<strong>每个子网包含哪些合法主机地址？</strong></p>
<p>​          <strong>子网                 0.0             128.0</strong></p>
<p>​          <strong>第一个主机地址      172.16.0.1        172.16.128.1</strong></p>
<p>​          <strong>最后一个主机地址    172.16.0.254      172.16.128.254</strong></p>
<p>​          <strong>广播地址            172.16.0.255      172.16.128.255</strong></p>
<p>　</p>
<p><strong>举例2**</strong>：172.16.0.0/24**</p>
<p>有多少个网络?</p>
<p>子网掩码是多少？</p>
<p>块大小是多少？</p>
<p>练习：</p>
<p>\1.  172.16.10.33/27属于哪个网络？该子网的广播地址是多少？</p>
<p>\2.  172.16.66.10  255.255.192.0 属于哪个子网？该子网的广播地址是多少？</p>
<p>\3.   172.16.50.10  255.255.224.0  属于哪个子网？该子网的广播地址是多少？</p>
<p>\4.  172.16.45.14  255.255.255.252  属于哪个子网？该子网的广播地址是多少？ </p>
<p>\5.  172.16.88.255/20 属于哪个子网？该子网的广播地址是多少？   </p>
<p><strong>A**</strong>类网络的子网划分**</p>
<p>​    A类网络的子网划分和C类网强没有什么不同，但需要处理的是24位，而B类和C类网络需要处理的分别是16位和8位。 </p>
<p>  <strong>举例1**</strong>：**10.0.0.0/16</p>
<p>​    多少个子网？2^8=256</p>
<p>​    每个子网的主机数？2^16-2=65534</p>
<p>​    有哪些合法子网？需要考虑的是第几个字节？只有第二个字节。256-255=1因此子</p>
<p>网为10.1.0.0   10.2.0.0   10.3.0.0 …….10.255.0.0</p>
<p>​        每个子网的广播地址是什么？</p>
<p>​        合法的主机地址是什么？</p>
<p>举例2：10.0.0.0/20</p>
<p><strong>CIDR**</strong>（classless inter-domain routing,<strong>**无类域间选择）</strong></p>
<p>   它是ISP用来将大量地址分配给客户的一种方法。</p>
<p><strong>CIDR**</strong>值表：**</p>
<p>255.0.0.0                /8        255.128.0.0              /9     255.192.0.0              /10</p>
<p>255.224.0.0              /11     255.240.0.0              /12   255.248.0.0              /13</p>
<p>255.252.0.0              /14     255.254.0.0              /15    255.255.0.0              /16    </p>
<p>255.255.128.0            /17   255.255.192.0            /18    255.255.224.0            /19</p>
<p>255.255.240.0           /20    255.255.248.0           /21    255.255.252.0           /22</p>
<p>255.255.254.0           /23     255.255.255.0           /24    255.255.255.128         /25</p>
<p>255.255.255.192         /26    255.255.255.224         /27    255.255.255.240         /28</p>
<p>255.255.255.248         /29    255.255.255.252         /30</p>
<h2 id="二、变长子网掩码："><a href="#二、变长子网掩码：" class="headerlink" title="二、变长子网掩码："></a><strong>二、变长子网掩码：</strong></h2><p>  <strong>使用长度不同的子网掩码将网络划分成多个子网，适用于不同类型的网络设计，称为VLSM**</strong>组网。**</p>
<p>   <strong>分类路由选择：RIP1  IGRP**</strong>协议**</p>
<p>   <strong>无类路由选择：RIP2</strong>　<strong>EIGRP</strong>　　<strong>OSPF**</strong>等协议**</p>
<p><strong>有类路由</strong>：汇总以后地址是标准的A B C类地址掩码 即 255.0.0.0 255.255.0.0 255.255.255.0 (<a href="https://www.baidu.com/s?wd=有类路由&from=1012015a&fenlei=mv6quAkxTZn0IZRqIHckPjm4nH00T1Y3rHTzm1c3uW6zuhmdm1bz0ZwV5Hcvrjm3rH6sPfKWUMw85HfYnjn4nH6sgvPsT6KdThsqpZwYTjCEQLGCpyw9Uz4Bmy-bIi4WUvYETgN-TLwGUv3EnWRsnHn1nWnd" target="_blank" rel="noopener">有类路由</a>里 大类网络中 子网码必须一致 这样叫做有类路由 因为有类路由协议不传递子网码信息)<br> 　　<strong>无类路由</strong>：汇总以后地址是无类的比如 172.16.12.0/16 - 172.16.15.0/16 汇总以后的地址是 172.16.12.0/20 子码 不属于 A B C 3个类别(无类路由是相反的 他传递子网信息所有大类网络中可以使用不同的子网码)</p>
<h3 id="１、典型的分类网络设计"><a href="#１、典型的分类网络设计" class="headerlink" title="１、典型的分类网络设计"></a><strong>１、典型的分类网络设计</strong></h3><p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6asdj1c06j30aq066weh.jpg" alt="/img"></p>
<h3 id="2-、无类网络设计"><a href="#2-、无类网络设计" class="headerlink" title="2**、无类网络设计**"></a><strong>2**</strong>、无类网络设计**</h3><p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ase4rv7oj30am064aa2.jpg" alt="/img"></p>
<h3 id="3、-变长子网掩码工作表"><a href="#3、-变长子网掩码工作表" class="headerlink" title="3、**变长子网掩码工作表**"></a><strong>3、**</strong>变长子网掩码工作表**</h3><h2 id="三、地址汇总"><a href="#三、地址汇总" class="headerlink" title="三、地址汇总"></a><strong>三、地址汇总</strong></h2><p><strong>汇总：也叫路由聚合，让路由选择协议能够用一个地址通告众多网络</strong>。<strong>旨在缩小路由器中路由选择表的规模，以节省内存，并缩短**</strong>IP<strong>**对路由选择表进行分析以找出前往远程网络的所需时间。</strong>图中说明了在互联网络的使用的汇总地址。</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6asefuaq4j30fk03mweg.jpg" alt="/img"></p>
<p><strong>举例1**</strong>：**</p>
<p>192.168.16.0—192.168.31.0  第三个字节：块大小16   240  /20   255.255.240.0</p>
<p>192.168.16.0/20   255.255.240.0   </p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6asez68mzj30fd03v74r.jpg" alt="/img"></p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6asfx80c6j30fd02rq31.jpg" alt="/img"></p>
<p><strong>思考？</strong></p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6asfi30wdj30fd06i3yi.jpg" alt="/img"></p>
<p>变化的字节在哪里？第二字节</p>
<p><strong>块大小？  16</strong></p>
<p>掩码值：256-16=240</p>
<p>255.240.0.0  /12  </p>
<p>172.0.0.0</p>
<p>172.16.0.0  32 48 64 80 96 112 128 144 160</p>
<p>172.144.0.0/12</p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6asgsrii1j30dw03nwer.jpg" alt="/img"></p>
<p><img src="http://ww1.sinaimg.cn/large/007ru3v0gy1g6ash917wvj30fe03gglp.jpg" alt="/img"></p>
<h2 id="四、-Cisco-Packet-Tracer介绍与思科设备的基本配置"><a href="#四、-Cisco-Packet-Tracer介绍与思科设备的基本配置" class="headerlink" title="四、 Cisco Packet Tracer介绍与思科设备的基本配置**"></a><strong>四、 <strong>Cisco Packet Tracer</strong></strong>介绍与思科设备的基本配置**</h2><h2 id="五、-PT-介绍及思科的基本操作命令"><a href="#五、-PT-介绍及思科的基本操作命令" class="headerlink" title="五、**PT**介绍及思科的基本操作命令"></a><strong>五、**</strong>PT<strong>**介绍及思科的基本操作命令</strong></h2><h3 id="1、PT介绍（界面、路由器、交换机、线缆、工具…-）"><a href="#1、PT介绍（界面、路由器、交换机、线缆、工具…-）" class="headerlink" title="1、PT介绍（界面、路由器、交换机、线缆、工具…..）"></a>1、PT介绍（界面、路由器、交换机、线缆、工具…..）</h3><p>双绞线：直通线、交叉线、全反线（CONSOLE线）</p>
<p>线序标准：</p>
<p>​        T568B：橙白 橙  绿白 蓝 蓝白 绿 棕白 棕</p>
<p>​        T568A：绿白 绿  橙白 蓝 蓝白 橙 棕白 棕</p>
<p>直通线：T568B-T568B    T568A-T568A</p>
<p><strong>不同种设备</strong>相连（模拟器不支持自适应）</p>
<p>​           交换机–路由器  路由器–集线器  交换机–PC机</p>
<p>​    交叉线：568A–568B 同种设备相连</p>
<p>​           交换机–交换机  路由器–路由器 交换机–集线器</p>
<p>全反线：（CONSOLE线）</p>
<h3 id="2、设备的连接"><a href="#2、设备的连接" class="headerlink" title="2、设备的连接"></a>2、设备的连接</h3><h3 id="3、路由器的开机过程："><a href="#3、路由器的开机过程：" class="headerlink" title="3、路由器的开机过程："></a>3、路由器的开机过程：</h3><p>开机过程：加电自检–从flash查找和装载IOS–从NVROM（非易失性                      </p>
<p>存储器）里加载启动配置文件—是否进入配置向导–</p>
<p>​                            直接进入配置模式</p>
<p>配置文件：startupconfig   runningconfig</p>
<p>启动配置文件   运行配置文件</p>
<h3 id="4、基本命令操作："><a href="#4、基本命令操作：" class="headerlink" title="4、基本命令操作："></a>4、基本命令操作：</h3><h3 id="5、"><a href="#5、" class="headerlink" title="5、"></a>5、</h3><p>（1）、模式：</p>
<p>​      Router&gt;用户模式</p>
<p>​      Router&gt;enable</p>
<p>​      Router#特权模式</p>
<p>​      Router#configure terminal </p>
<p>​      Router(config)#全局配置模式</p>
<p>​      Router(config)#hostname R1  （配置路由器的名称）</p>
<p>​      R1(config)#interface FastEthernet 0/0</p>
<p>​      R1(config-if)#接口模式</p>
<p>​      R1(config-if)#ip address 192.168.1.1 255.255.255.0 （配置IP地址）</p>
<p>​      R1(config-if)#no shutdown （开启端口）</p>
<p>​      两台路由器相连，测试连通性</p>
<p>​       Router&gt;用户模式</p>
<p>​       Router&gt;enable</p>
<p>​       Router#特权模式</p>
<p>​       Router#configure terminal </p>
<p>​       Router(config)#全局配置模式</p>
<p>​       Router(config)#hostname R2  （配置路由器的名称）</p>
<p>​       R2(config)#interface FastEthernet 0/0</p>
<p>​       R2(config-if)#接口模式</p>
<p>​       R2(config-if)#ip address 192.168.1.2 255.255.255.0 （配置IP地址）</p>
<p>​       R2(config-if)#no shutdown （开启端口）</p>
<p>​       使用ping命令测试通信：如果通信用!!!表示，不通用…表示</p>
<p>​           R1(config-if)#接口模式</p>
<p>​           R1(config-if)#exit  退出当前模式，返回上一级模式</p>
<p>​           R1(config)#全局配置模式</p>
<p>​           R1(config)#exit</p>
<p>​           R1#特权模式</p>
<p>​           R1#ping 192.168.1.1 </p>
<p>​        –输入end（或ctrl+c或ctrl+z）直接返回到特权模式—————–</p>
<p>​            R1(config-if)#end</p>
<p>​            R1#特权模式</p>
<p>​        -——————————————</p>
<p>   （2）命令支持简写</p>
<p>   （3）帮助功能</p>
<p>   （4）tab补全命令</p>
<p>   （5）给设备配置密码：防止别人非法更改我设备的配置</p>
<p>​       </p>
<p>​      为特权模式配置明文密码</p>
<p>​       R1(config)#enable password 123456   明文密码</p>
<p>​       R1(config)#show running-config   可以查看密码</p>
<p>​       Current configuration : 565 bytes  配置文件大小可以判断是否更改设备配置</p>
<p>​      为特权模式配置密文密码</p>
<p>​       R1(config)#enable secret 123456   明文密码</p>
<p>​       R1(config)#show running-config   可以查看密码</p>
<p>​       两个密码同时配置时，加密的密码生效。</p>
<p>   （6）保存配置文件</p>
<p>​       R1#copy <strong>running-config</strong> startup-config  </p>
<p>​       或  R1#write</p>
<p>​              </p>
<p>   （7）查看命令</p>
<p>​        R1#show ip interface brief  查看接口摘要信息</p>
<p>​        R1#show running-config      查年当前的运行配置文件</p>
<p>​        R1#show startup-config      查看启动配置文件</p>
<p>Running-config本来和startup-config 一样 但是running-config如果不保存的话，就不会和startup-config一样了</p>
<p>   （8）重启设备：</p>
<p>​        R1#reload</p>
<p>​     </p>
<p>模式：</p>
<p>enable (en)  configure terminal(config t)   interface fastEthernet 0/1(int f0/1)</p>
<p>Show</p>
<p>running-config    startup-config</p>
<p>copy runing-config startup-config 或 write(w)</p>
<p>Ip add 192.168.10.1 255.255.255.0</p>
<p>no shutdown</p>
<p>reload</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/网络/">网络</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
    </nav>
  

</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2019 John Doe
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank">Hexo &nbsp;&nbsp;</a><a href="https://github.com/maochunguang" target="_blank">Blog</a> by tommy
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >极客到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>

    </div>
    
<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>

<script src="/js/main.js"></script>

    <script>
        $(document).ready(function() {
            var backgroundnum = 1;
            var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
            $("#mobile-nav").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
            $(".left-col").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
        })
    </script>


<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'xxxxx', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



	<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?xxxxxx";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>



<div class="scroll" id="scroll">
    <a href="#"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <script language="javascript">
    $(function() {
        $("a[title]").each(function() {
            var a = $(this);
            var title = a.attr('title');
            if (title == undefined || title == "") return;
            a.data('title', title).removeAttr('title').hover(
            function() {
                var offset = a.offset();
                $("<div id=\"anchortitlecontainer\"></div>").appendTo($("body")).html(title).css({
                    top: offset.top - a.outerHeight() - 15,
                    left: offset.left + a.outerWidth()/2 + 1
                }).fadeIn(function() {
                    var pop = $(this);
                    setTimeout(function() {
                        pop.remove();
                    }, pop.text().length * 800);
                });
            }, function() {
                $("#anchortitlecontainer").remove();
            });
        });
    });
</script>


  </div>
</body>
</html>